<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Stefan Armbruster, Graeme Rocher, Puneet Behl">
<title>GORM for Neo4j</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>GORM for Neo4j</h1>
<div class="details">
<span id="author" class="author">Stefan Armbruster, Graeme Rocher, Puneet Behl</span><br>
<span id="revnumber">version 8.1.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#compatibility">Compatibility with GORM for Hibernate</a></li>
<li><a href="#releaseNotes">Release History</a></li>
<li><a href="#upgrading">Upgrading from previous versions</a></li>
</ul>
</li>
<li><a href="#gettingStarted">Getting Started</a>
<ul class="sectlevel2">
<li><a href="#configurationOptions">Neo4j Bolt Driver Configuration Options</a></li>
<li><a href="#usingNeo4jStandalone">Using Neo4j Standalone</a></li>
<li><a href="#combiningNeo4jAndHibernate">Combining Neo4j And Hibernate</a></li>
<li><a href="#springBoot">Using GORM in Spring Boot</a></li>
<li><a href="#standalone">GORM for Neo4j without Grails</a></li>
</ul>
</li>
<li><a href="#mapping">Mapping Domain Classes to Nodes</a>
<ul class="sectlevel2">
<li><a href="#idGeneration">Neo4j ID generators</a></li>
<li><a href="#associations">Understanding Association Mapping</a></li>
<li><a href="#labelStrategy">Customizing the Label Strategy</a></li>
<li><a href="#schemaless">Dynamic Properties and Associations</a></li>
</ul>
</li>
<li><a href="#relationships">Mapping Domain Classes to Relationships</a>
<ul class="sectlevel2">
<li><a href="#relationshipType">Controlling the Relationship Type</a></li>
<li><a href="#relationshipType">Querying and Relationships</a></li>
</ul>
</li>
<li><a href="#querying">Querying with GORM for Neo4j</a>
<ul class="sectlevel2">
<li><a href="#lazyLoading">Understanding Lazy Loading</a></li>
<li><a href="#cypher">Querying with Cypher</a></li>
<li><a href="#indexing">Defining the Query Index</a></li>
<li><a href="#paths">Querying for Paths</a></li>
<li><a href="#queryingRelationships">Querying for Relationships</a></li>
<li><a href="#dataServices">GORM for Neo4j Data Services</a></li>
</ul>
</li>
<li><a href="#testing">Testing</a></li>
<li><a href="#multipleDataSources">Multiple Data Sources</a>
<ul class="sectlevel2">
<li><a href="#_configuring_multiple_bolt_drivers">Configuring Multiple Bolt Drivers</a></li>
<li><a href="#_mapping_domain_classes_to_bolt_drivers">Mapping Domain Classes to Bolt Drivers</a></li>
<li><a href="#_switching_between_bolt_drivers">Switching between Bolt Drivers</a></li>
</ul>
</li>
<li><a href="#multiTenancy">Multi-Tenancy</a>
<ul class="sectlevel2">
<li><a href="#_configuring_multi_tenancy">Configuring Multi Tenancy</a></li>
<li><a href="#_multi_tenancy_modes">Multi Tenancy Modes</a></li>
</ul>
</li>
<li><a href="#neo4jEnhancements">Enhancements to Neo4j Java Driver API</a>
<ul class="sectlevel3">
<li><a href="#_getting_properties_from_nodes">Getting Properties from Nodes</a></li>
<li><a href="#_cast_a_node_to_a_map">Cast a Node to a Map</a></li>
</ul>
</li>
<li><a href="#reference">Reference</a>
<ul class="sectlevel2">
<li><a href="#ref-additional-gorm-methods">Additional Gorm Methods</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.neo4j.org">Neo4j</a> a Graph database that fits nicely in a Grails application.</p>
</div>
<div class="paragraph">
<p>The goal of GORM for Neo4j is to provide a <em>as-complete-as-possible</em> GORM implementation that maps domain classes and instances to the Neo4j nodespace. The following features are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marshalling from Neo4j Nodes to Groovy types and back again</p>
</li>
<li>
<p>Support for GORM dynamic finders, criteria and named queries</p>
</li>
<li>
<p>Session-managed transactions</p>
</li>
<li>
<p>access to Neo4j&#8217;s traversal capabilities</p>
</li>
<li>
<p>Access the Neo4j graph database via the Bolt Java Driver</p>
</li>
<li>
<p>Neo4j autoindexing</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="compatibility">Compatibility with GORM for Hibernate</h3>
<div class="paragraph">
<p>This implementation tries to be as compatible as possible with GORM for Hibernate. In general you can refer to the <a href="../../hibernate">GORM for Hibernate documentation</a> as the majority of features are implemented across both.</p>
</div>
<div class="paragraph">
<p>The following key features are supported by GORM for Neo4j:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simple persistence methods (save,delete etc)</p>
</li>
<li>
<p>Dynamic finders</p>
</li>
<li>
<p>Criteria queries</p>
</li>
<li>
<p>Named queries</p>
</li>
<li>
<p>Inheritance</p>
</li>
<li>
<p>Embedded types</p>
</li>
<li>
<p>Query by example</p>
</li>
<li>
<p>Many-to-many associations (these can be modelled with a mapping class)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, some features are not supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HQL queries (however Cypher Queries are)</p>
</li>
<li>
<p>Composite primary keys</p>
</li>
<li>
<p>Any direct interaction with the Hibernate API</p>
</li>
<li>
<p>Custom Hibernate user types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There may be other limitations not mentioned here so in general it shouldn&#8217;t be expected that an application based on GORM for Hibernate will "just work" without some tweaking involved. Having said that, the large majority of common GORM functionality is supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="releaseNotes">Release History</h3>
<div class="sect3">
<h4 id="_7_1_x">7.1.x</h4>
<div class="ulist">
<ul>
<li>
<p>Support Apache Groovy 3, and Java 14</p>
</li>
<li>
<p>Neo4J Driver 4.3</p>
</li>
<li>
<p>Spring 5.3, Spring Boot 2.5</p>
</li>
<li>
<p>Autowire bean by-type in the Data Service</p>
</li>
<li>
<p>Compatible Only with Grails 5 or higher</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_7_0_x">7.0.x</h4>
<div class="ulist">
<ul>
<li>
<p>Java 8 Minimum</p>
</li>
<li>
<p>Support for Neo4j Bolt Driver 1.7</p>
</li>
<li>
<p>Support for Neo4j 3.5.x</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_6_2_x">6.2.x</h4>
<div class="ulist">
<ul>
<li>
<p>Support for Neo4j Bolt Driver 1.5</p>
</li>
<li>
<p>Support for Neo4j 3.3.x</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_6_1_x">6.1.x</h4>
<div class="ulist">
<ul>
<li>
<p>Support for assigned identifiers</p>
</li>
<li>
<p>Batch inserts with UNWIND and FOREACH when using assigned ids</p>
</li>
<li>
<p>Support for mapping entities to Neo4j Relationships</p>
</li>
<li>
<p>Support for querying Neo4j Paths</p>
</li>
<li>
<p>Support for lists basic types</p>
</li>
<li>
<p>Upgrade to Neo4j Bolt Driver 1.2</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_6_0_x">6.0.x</h4>
<div class="ulist">
<ul>
<li>
<p>Support for Neo4j 3.0.x or above</p>
</li>
<li>
<p>Rewritten for Neo4j Bolt Java Driver</p>
</li>
<li>
<p>Support for Multiple Data Sources (Connections)</p>
</li>
<li>
<p>Multi Tenancy support for DATABASE and DISCRIMINATOR approaches</p>
</li>
<li>
<p>Refactored Bootstrapping</p>
</li>
<li>
<p>Uses new DynamicAttributes trait</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_5_0_x">5.0.x</h4>
<div class="paragraph">
<p>The following new features are available in this release.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for Neo4j 2.3.x or above</p>
</li>
<li>
<p>Ability to query using Cypher with the default GORM methods (find, findAll)</p>
</li>
<li>
<p>Robust Spring Transaction Management</p>
</li>
<li>
<p>Support for Lazy &amp; Eager Loading using OPTIONAL MATCH</p>
</li>
<li>
<p>Improved Performance</p>
</li>
<li>
<p>Dirty Checking Implementation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using an older version of the plugin, and looking to upgrade the following changes may impact you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Neo4j JDBC is no longer used and the corresponding CypherEngine interface was removed</p>
</li>
<li>
<p>Dynamic associations are disabled by default, you can re-enable them in your entity mapping</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_4_0_x">4.0.x</h4>
<div class="ulist">
<ul>
<li>
<p>Rewritten for Groovy traits &amp; Grails 3</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_3_0_x">3.0.x</h4>
<div class="ulist">
<ul>
<li>
<p>Initial support for Neo4j 2.0.x</p>
</li>
<li>
<p>Support for Cypher via Neo4j JDBC</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_2_0_x">2.0.x</h4>
<div class="ulist">
<ul>
<li>
<p>Refinements from 1.0.x</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_x">1.0.x</h4>
<div class="ulist">
<ul>
<li>
<p>works with Neo4j HA</p>
</li>
<li>
<p>implementing new GORM property criteria filters</p>
</li>
<li>
<p>uses Neo4j 1.8.2</p>
</li>
<li>
<p>first GORM compliant version of the plugin</p>
</li>
<li>
<p>works with embedded and REST Neo4j databases</p>
</li>
<li>
<p>exposing traversal options to domain classes</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading">Upgrading from previous versions</h3>
<div class="sect3">
<h4 id="_dependency_upgrades">Dependency Upgrades</h4>
<div class="paragraph">
<p>GORM 7.1 supports Apache Groovy 3, Java 14, Neo4J Driver 4.3 and Spring 5.3.x.</p>
</div>
<div class="paragraph">
<p>Each of these underlying components may have changes that require altering your application. These changes are beyond the scope of this documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_default_autowire_by_type_inside_gorm_data_services">Default Autowire By Type inside GORM Data Services</h4>
<div class="paragraph">
<p>A Grails Service (or a bean) inside GORM DataService will default to autowire by-type, For example:</p>
</div>
<div class="paragraph">
<p><em>./grails-app/services/example/BookService.groovy</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>package example

import grails.gorm.services.Service

@Service(Book)
abstract class BookService {

    TestService testRepo

    abstract Book save(String title, String author)

    void doSomething() {
        assert testRepo != null
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that with autowire by-type as the default, when multiple beans for same type are found the application with throw Exception. Use the Spring `@Qualifier annotation for <a href="https://docs.spring.io/spring-framework/docs/5.3.10/reference/html/core.html#beans-autowired-annotation-qualifiers">Fine-tuning Annotation Based Autowiring with Qualifiers</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_changes">Configuration Changes</h4>
<div class="paragraph">
<p>The version 4 of the Neo4j driver contains changes in the configuration builder which require configuration changes to conform to them. For example <code>grails.neo4j.options.maxSessions</code> is now <code>grails.neo4j.options.maxConnectionPoolSize</code>. Some configuration defaults have also changed, so be sure to check the documentation of the driver for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bolt_java_driver_and_api_changes">Bolt Java Driver and API Changes</h4>
<div class="paragraph">
<p>The API has changed to accommodate the new Neo4j Bolt driver.</p>
</div>
<div class="paragraph">
<p>Therefore you need to replace the usages of the following interfaces with their bolt equivalents:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.v1.Driver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.Driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.v1.Transaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.Transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.v1.types.Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.types.Node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.v1.types.Relationship</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.types.Relationship</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.v1.StatementResult</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.driver.Result</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There may be other classes that you need to replace references too. The <code>org.neo4j.driver.v1</code> package has shed its <code>v1</code> package, however there are also other changes.[.line-through]##</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gettingStarted">Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started with GORM for Neo4j you need to install the plugin into a Grails application.</p>
</div>
<div class="paragraph">
<p>For Grails 3.x and above you need to edit your <code>build.gradle</code> file and add the plugin as a dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
	compile 'org.grails.plugins:neo4j:8.1.0'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using a version of Grails 3 earlier than 3.3 then you may need to enforce the GORM version. If you are using Grails 3.2.7 or above this can be done by modifying the <code>gormVersion</code> setting in <code>gradle.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gormVersion=8.1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise if you are using an earlier version of Grails you can force the GORM version by adding the following block directly above the <code>dependencies</code> block:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details ->
        if( details.requested.group == 'org.grails' &&
            details.requested.name.startsWith('grails-datastore')) {
            details.useVersion("8.1.0")
        }
    }
}
dependencies {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
GORM for Neo4j requires Grails 2.5.x or above and Neo4j 3.0.x or above, if you wish to use Neo4j 2.3.x use the <a href="https://gorm.grails.org/5.0.x">5.x version</a> of GORM
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the plugin for Grails 2.x edit the <code>grails-app/conf/BuildConfig.groovy</code> file and add the following plugin definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    compile ':neo4j:8.1.0'
    build ':tomcat:8.22'
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Grails 2.5.x must be configured with Tomcat 8 when using Neo4j in <code>embedded</code> mode, since the Neo4j server depends newer versions of the Servlet API and will not work with Tomcat 7.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the Grails plugin assumes you have a Neo4j instance running on port <code>7687</code>, however you can run Neo4j embedded by including the following configuration in <code>grails-app/conf/application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">neo4j</span>:
        <span class="key">type</span>: <span class="string"><span class="content">embedded</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then adding the Neo4j test harness to your <code>provided</code> dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">provided <span class="string"><span class="delimiter">'</span><span class="content">org.neo4j.test:neo4j-harness:3.0.2</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Neo4j server uses Jetty, so when you add Neo4j as embedded Grails will also use Jetty (not Tomcat) as the container since it discovered on the classpath, therefore it is not recommended to use Neo4j embedded.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Neo4j server URL you can use the <code>grails.neo4j.url</code> setting in <code>grails-app/conf/application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">neo4j</span>:
        <span class="key">url</span>: <span class="string"><span class="content">bolt://localhost:7687</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configurationOptions">Neo4j Bolt Driver Configuration Options</h3>
<div class="paragraph">
<p>The following options can be configured in <code>grails-app/conf/application.yml</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails.neo4j.url</code> - The Neo4j Bolt URL</p>
</li>
<li>
<p><code>grails.neo4j.buildIndex</code> - Whether to build the Neo4j index on startup (defaults to true)</p>
</li>
<li>
<p><code>grails.neo4j.type</code> - The Neo4j server type. If set to <code>embedded</code> loads an embedded server</p>
</li>
<li>
<p><code>grails.neo4j.flush.mode</code> - The flush mode to use when working with Neo4j sessions. Default to <code>AUTO</code>.</p>
</li>
<li>
<p><code>grails.neo4j.username</code> - The username to use to authenticate</p>
</li>
<li>
<p><code>grails.neo4j.password</code> - The password to use to authenticate</p>
</li>
<li>
<p><code>grails.neo4j.default.mapping</code> - The default database mapping. Must be a closure configured in <code>application.groovy</code></p>
</li>
<li>
<p><code>grails.neo4j.options</code> - Any options to be passed to the driver</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>grails.neo4j.options</code> setting allows you to configure the properties of <a href="https://neo4j.com/docs/api/java-driver/4.0/org/neo4j/driver/Config.html">org.neo4j.driver.Config</a>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">neo4j</span>:
        <span class="key">options</span>:
            <span class="key">maxConnectionPoolSize</span>: <span class="string"><span class="content">100</span></span>
            <span class="key">connectionLivenessCheckTimeout</span>: <span class="string"><span class="content">200</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For builder methods with 0 arguments, setting the configuration value to true will cause the method to be executed. For example the following configuration will result in the <a href="https://neo4j.com/docs/api/java-driver/4.0/org/neo4j/driver/Config.ConfigBuilder.html#withEncryption--">ConfigBuilder#withEncryption</a> method to be called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">neo4j</span>:
        <span class="key">options</span>:
            <span class="key">encryption</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For builder methods with more than 1 argument, it is possible to configure values for the method using <code>arg#</code> syntax. For example the following configuration will result in the <a href="https://neo4j.com/docs/api/java-driver/4.0/org/neo4j/driver/Config.ConfigBuilder.html#withConnectionTimeout-long-java.util.concurrent.TimeUnit-">ConfigBuilder#withConnectionTimeout</a> method to be called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">neo4j</span>:
        <span class="key">options</span>:
            <span class="key">connectionTimeout</span>:
                <span class="key">arg0</span>: <span class="string"><span class="content">10</span></span>
                <span class="key">arg1</span>: <span class="string"><span class="content">SECONDS</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="usingNeo4jStandalone">Using Neo4j Standalone</h3>
<div class="paragraph">
<p>If you plan to use Neo4j as your primary datastore then you need to remove the Hibernate plugin by editing your <code>BuildConfig</code> or <code>build.gradle</code> (dependending on the version of Grails) and removing the Hibernate plugin definition</p>
</div>
<div class="paragraph">
<p>With this done all domain classes in grails-app/domain will be persisted via Neo4j and not Hibernate. You can create a domain class by running the regular <code>create-domain-class</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-domain-<span class="type">class</span> <span class="class">Person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Person</code> domain class will automatically be a persistent entity that can be stored in Neo4j.</p>
</div>
</div>
<div class="sect2">
<h3 id="combiningNeo4jAndHibernate">Combining Neo4j And Hibernate</h3>
<div class="paragraph">
<p>If you have both the Hibernate and Neo4j plugins installed then by default all classes in the <code>grails-app/domain</code>  directory will be persisted by Hibernate and not Neo4j. If you want to persist a particular domain class with Neo4j then you must use the <code>mapWith</code> property in the domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mapWith = <span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springBoot">Using GORM in Spring Boot</h3>
<div class="paragraph">
<p>To use GORM for Neo4j in Spring Boot add the necessary dependencies to your Boot application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile("org.grails:gorm-neo4j-spring-boot:8.1.0")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure your Boot <code>Application</code> class is annotated with <code>ComponentScan</code>, example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.*</span>

<span class="annotation">@Configuration</span>
<span class="annotation">@EnableAutoConfiguration</span>
<span class="annotation">@ComponentScan</span>
<span class="type">class</span> <span class="class">Application</span> {
    <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run Application, args
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>ComponentScan</code> without a value results in Boot scanning for classes in the same package or any package nested within the <code>Application</code> class package.
If your GORM entities are in a different package specify the package name as the value of the <code>ComponentScan</code> annotation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally create your GORM entities and ensure they are annotated with <code>grails.persistence.Entity</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.annotation.*</span>

<span class="annotation">@Entity</span>
<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure GORM for Neo4j within Spring Boot create an <code>application.yml</code> file and populate your <a href="#configurationOptions">configuration</a> options within it.</p>
</div>
</div>
<div class="sect2">
<h3 id="standalone">GORM for Neo4j without Grails</h3>
<div class="paragraph">
<p>If you wish to use GORM for Neo4j outside of a Grails application you should declare the necessary dependencies, for example in Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile "org.grails:grails-datastore-gorm-neo4j:8.1.0"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then annotate your entities with the <code>grails.gorm.annotation.Entity</code> annotation and implement the <a href="../api/grails/neo4j/Node.html">Node</a> trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.neo4j.*</span>
<span class="keyword">import</span> <span class="include">grails.gorm.annotation.*</span>

<span class="annotation">@Entity</span>
<span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> Node&lt;Person&gt;{
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to place the bootstrap logic somewhere in your application which uses <a href="../api/org/grails/datastore/gorm/neo4j/Neo4jDatastore.html">Neo4jDatastore</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> datastore = <span class="keyword">new</span> Neo4jDatastore(Person)

println Person.count()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For configuration you can either pass a map or an instance of the <code>org.springframework.core.env.PropertyResolver</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> datastore = <span class="keyword">new</span> Neo4jDatastore([<span class="string"><span class="delimiter">'</span><span class="content">grails.neo4j.url</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">bolt://...</span><span class="delimiter">'</span></span>], Person)

println Person.count()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Spring with an existing <code>ApplicationContext</code> you can instead call use <a href="../api/grails/neo4j/bootstrap/Neo4jDataStoreSpringInitializer.html">Neo4jDataStoreSpringInitializer</a> and call <code>configureForBeanDefinitionRegistry</code> prior to refreshing the context. You can pass the Spring <code>Environment</code> object to the constructor for configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext myApplicationContext = ...
def initializer = <span class="keyword">new</span> Neo4jDataStoreSpringInitializer(myApplicationContext.getEnvironment(), Person)
initializer.configureForBeanDefinitionRegistry(myApplicationContext)

println Person.count()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mapping">Mapping Domain Classes to Nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for Neo4j will map each Grails domain instance to a Node in the node space. For example given the following domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Pet</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each domain class will implement the <a href="../api/grails/neo4j/Neo4jEntity.html">Neo4jEntity</a> trait. You can define this explicitly if you prefer (the <code>Node</code> trait is a subtrait of <code>Neo4jEntity</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.neo4j.Node</span>

<span class="type">class</span> <span class="class">Pet</span> <span class="directive">implements</span> Node&lt;Pet&gt; {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When an instance of <code>Pet</code> is saved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Pet(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Dino</span><span class="delimiter">&quot;</span></span>)
p.save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the following Cypher <code>CREATE</code> is issued:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">CREATE (<span class="key">n2</span>:Pet {props})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties of the class are converted to native Neo4j types and set as the <code>props</code> parameter to the query.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to see what queries GORM for Neo4j generates, enabling logging for the <code>org.grails.datastore.gorm.neo4j</code> package
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="idGeneration">Neo4j ID generators</h3>
<div class="paragraph">
<p>GORM by default uses a native Neo4j node identifiers for each <code>id</code> property of a domain class.
These have a couple of disadvantages that should encourage you to use an alternative id generation strategy:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Neo4j node ids are more like internal identifiers used by Neo4j to identify nodes (equivalent to the <code>rowid</code> in a SQL database), but can be potentially re-used if data is deleted and recreated. This makes them not appropriate for use as a public facing key.</p>
</li>
<li>
<p>In order to obtain a Node id GORM must perform an insert (similar to the way GORM for Hibernate has to perform a SQL INSERT if the id generation strategy is an auto-increment column), which means it cannot efficiently batch up Cypher <code>CREATE</code> statements.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This last disadvantage can be worked around by using the <code>saveAll</code> method to save multiple domain classes at once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Club.saveAll([
    <span class="keyword">new</span> Club(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Manchester United</span><span class="delimiter">&quot;</span></span>),
    <span class="keyword">new</span> Club(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Arsenal</span><span class="delimiter">&quot;</span></span>)
])</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, it is generally better to consider a different id generation strategy.</p>
</div>
<div class="sect3">
<h4 id="_assigned_identifiers">Assigned Identifiers</h4>
<div class="paragraph">
<p>The recommended approach is to use <code>assigned</code> identifiers that relate to your domain. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Owner</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">pets</span>:Pet]
    <span class="directive">static</span> mapping = node {
        id <span class="key">generator</span>:<span class="string"><span class="delimiter">'</span><span class="content">assigned</span><span class="delimiter">'</span></span>, <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>
    }
}
<span class="type">class</span> <span class="class">Pet</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> belongsTo = [<span class="key">owner</span>:<span class="predefined-type">Owner</span>]
    <span class="directive">static</span> mapping = node {
        id <span class="key">generator</span>:<span class="string"><span class="delimiter">'</span><span class="content">assigned</span><span class="delimiter">'</span></span>, <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With assigned identifiers GORM can do a much better job of optimizing write operations. For example the following logic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">deleteOwners &lt;&lt; <span class="keyword">new</span> <span class="predefined-type">Owner</span>(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>)
        .addToPets(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Dino</span><span class="delimiter">&quot;</span></span>)
        .addToPets(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>)
        .save()
deleteOwners &lt;&lt; <span class="keyword">new</span> <span class="predefined-type">Owner</span>(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Barney</span><span class="delimiter">&quot;</span></span>)
        .addToPets(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Hoppy</span><span class="delimiter">&quot;</span></span>)
        .save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>GORM will generate the following Cypher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">UNWIND {ownerBatch} as row
CREATE (owner:Owner)
SET owner += row.props
FOREACH (pets IN row.pets |
    CREATE (pet:Pet)
    SET pet += pets.props
    MERGE (owner)-[:PETS]-&gt;(pet)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how <code>UNWIND</code> and <code>FOREACH</code> are used to create both the entity and its associations in one go, significantly improving write performance for large data sets.</p>
</div>
</div>
<div class="sect3">
<h4 id="_snowflake_identifiers">Snowflake Identifiers</h4>
<div class="paragraph">
<p>Another option is a custom identity generator based on the Snowflake algorithm and stores the generated identifier in a property of each Neo4j node called <code>__id__</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">grails.neo4j.mapping.MappingBuilder.*</span>
<span class="type">class</span> <span class="class">Club</span> {
    <span class="predefined-type">String</span> name
    ...
    static mapping = node {
        id {
            generator <span class="string"><span class="delimiter">&quot;</span><span class="content">snowflake</span><span class="delimiter">&quot;</span></span>
        }
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_globally_changing_identity_strategy">Globally Changing Identity Strategy</h4>
<div class="paragraph">
<p>If you wish to globally change id generation then you can do so in <code>grails-app/conf/application.groovy</code> (<code>Config.groovy</code> in Grails 2.x):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.neo4j.default.mapping = {
    id <span class="key">generator</span>:<span class="string"><span class="delimiter">'</span><span class="content">assigned</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_identifiers">Custom Identifiers</h4>
<div class="paragraph">
<p>In addition, if you wish to use a custom identity generation strategy you can do so by specifying a class name that implements the <code>IdGenerator</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.neo4j.default.mapping = {
    id <span class="key">generator</span>:<span class="string"><span class="delimiter">'</span><span class="content">com.foo.MyIdGenerator</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="associations">Understanding Association Mapping</h3>
<div class="paragraph">
<p>GORM for Neo4j will create Neo4j relationships between nodes for you based on the relationship ownership rules defined in your GORM mapping. For example the following mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Owner</span> <span class="directive">implements</span> Neo4jEntity&lt;<span class="predefined-type">Owner</span>&gt; {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">pets</span>:Pet]
}
<span class="type">class</span> <span class="class">Pet</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> belongsTo = [<span class="key">owner</span>:<span class="predefined-type">Owner</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you save the relationship:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Owner</span> owner = <span class="keyword">new</span> <span class="predefined-type">Owner</span>(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">David</span><span class="delimiter">&quot;</span></span>)
    .addToPets(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Dino</span><span class="delimiter">&quot;</span></span>)
    .save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)
    .discard()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>save()</code> method will generate a Cypher relationship creation query as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (from:Owner),(to:Pet) WHERE ID(from) = {start} AND ID(to) IN {end} MERGE (from)-[r:PETS]-&gt;(to)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the query the relationship is defined as <code>(from)-[r:PETS]-&gt;(to)</code>, with the direction of the association defined by who "owns" the association. Since <code>Pet</code> defines a <code>belongTo</code> association to <code>Owner</code>, this means that <code>Owner</code> owns the association and the relationship is from <code>Owner</code> to <code>Pet</code>.</p>
</div>
<div class="paragraph">
<p>You can customize the Neo4j relationship type and direction using the <code>mapping</code> block if necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">grails.neo4j.Direction.*</span>

<span class="type">class</span> <span class="class">Owner</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">pets</span>:Pet]

    <span class="directive">static</span> mapping = {
         pets <span class="key">type</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">PETZ</span><span class="delimiter">&quot;</span></span>, <span class="key">direction</span>:BOTH
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case a bidirectional relationship will be created  in the graph such as <code>(from)&lt;-[r:PETZ]-&gt;(to)</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information on defining relationships with GORM, see the <a href="https://grails.github.io/grails-doc/latest/guide/GORM.html#gormAssociation">corresponding guide in the GORM documentation</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="labelStrategy">Customizing the Label Strategy</h3>
<div class="paragraph">
<p>The default strategy for defining labels is to use the class name, however the strategy to define labels for a given node is completely configurable. For example you can use static mapping to define you labels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">static</span> mapping = {
        labels <span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">People</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define labels dynamically. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">static</span> mapping = {
        labels { GraphPersistentEntity pe -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">`</span><span class="inline"><span class="inline-delimiter">${</span>pe.javaClass.name<span class="inline-delimiter">}</span></span><span class="content">`</span><span class="delimiter">&quot;</span></span> }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Dynamic labels have a negative impact on write performance as GORM is unable to batch operations with dynamic labels so should be used sparingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or mix static and dynamic labels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mapping = {
    labels <span class="string"><span class="delimiter">&quot;</span><span class="content">People</span><span class="delimiter">&quot;</span></span>, { GraphPersistentEntity pe -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">`</span><span class="inline"><span class="inline-delimiter">${</span>pe.javaClass.name<span class="inline-delimiter">}</span></span><span class="content">`</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the cost of read/write performance you can define dynamic labels based on an instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mapping = {
    labels { GraphPersistentEntity pe, instance -&gt;  <span class="comment">// 2 arguments: instance dependent label</span>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">`</span><span class="inline"><span class="inline-delimiter">${</span>instance.profession<span class="inline-delimiter">}</span></span><span class="content">`</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schemaless">Dynamic Properties and Associations</h3>
<div class="paragraph">
<p>Neo4j is a schemaless database. This means that, unlike SQL where you can only have a fixed number of rows and columns, nodes can have unlimited properties.</p>
</div>
<div class="paragraph">
<p>Most existing object mapping tools in statically typed languages don&#8217;t allow you to harness this power, but GORM for Neo4j allows you to define both statically defined properties (ie the properties of the domain class) and domain properties.</p>
</div>
<div class="paragraph">
<p>For example, take the following domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Plant</span> {
    <span class="predefined-type">String</span> name
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set both the statically defined <code>name</code> property, but also any arbitrary number of dynamic properties using the subscript operator in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Plant(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Carrot</span><span class="delimiter">&quot;</span></span>)
  p[<span class="string"><span class="delimiter">'</span><span class="content">goesInPatch</span><span class="delimiter">'</span></span>] = <span class="predefined-constant">true</span>
  p.save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any simple properties can be included, however if you wish to have dynamic associations you can as well by modifying the mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Plant</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> mapping = {
        dynamicAssociations <span class="predefined-constant">true</span>
    }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in place you can define dynamic associations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Plant(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Carrot</span><span class="delimiter">&quot;</span></span>)
  p[<span class="string"><span class="delimiter">'</span><span class="content">related</span><span class="delimiter">'</span></span>] = [ <span class="keyword">new</span> Plant(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Potato</span><span class="delimiter">&quot;</span></span>).save() ]
  p.save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Dynamic associations have a runtime performance cost as when you access any dynamic property GORM has to issue a separate query to retrieve that association if the value is null, use with care.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="relationships">Mapping Domain Classes to Relationships</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to being able to map a domain class to a Neo4j <code>Node</code>, since 6.1 you are able to map a domain class to a Neo4j <code>Relationship</code>.</p>
</div>
<div class="paragraph">
<p>For example consider the following domain model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.neo4j.*</span>

<span class="type">class</span> <span class="class">Movie</span> {
    <span class="predefined-type">String</span> title
    <span class="directive">static</span> hasMany = [<span class="key">cast</span>:CastMember]
}

<span class="type">class</span> <span class="class">CastMember</span> <span class="directive">implements</span> Relationship&lt;Person, Movie&gt; {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; roles = <span class="type">[]</span>
}

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">appearances</span>:CastMember]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CastMember</code> class implements the <a href="../api/grails/neo4j/Relationship.html">Relationship</a> trait which takes two generic arguments: The class that represents the start of the relationship and the class that represents the end.</p>
</div>
<div class="paragraph">
<p>You can then use regular GORM methods to query the <code>CastMember</code> relationship. In addition because Neo4j relationships are dynamic you can assign additional properties to them at runtime. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> castMember = <span class="keyword">new</span> CastMember(
    <span class="key">from</span>: <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Keanu</span><span class="delimiter">&quot;</span></span>),
    <span class="key">to</span>: <span class="keyword">new</span> Movie(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Matrix</span><span class="delimiter">&quot;</span></span>),
    <span class="key">roles</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Neo</span><span class="delimiter">&quot;</span></span>])

castMember[<span class="string"><span class="delimiter">'</span><span class="content">realName</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">Thomas Anderson</span><span class="delimiter">&quot;</span></span>
castMember.save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the <code>roles</code> property is saved as a property of the relationship, as is the dynamic <code>realName</code> property.</p>
</div>
<div class="paragraph">
<p>You can then query relationships using these properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">CastMember cm = CastMember.findByRoles([<span class="string"><span class="delimiter">'</span><span class="content">Neo</span><span class="delimiter">'</span></span>])
Person person = cm.from
println person.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will produce a Cypher query that queries the relationship rather than the nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MATCH (n:Person)-[from:CASTMEMBER]-&gt;(to:Movie) WHERE ( r.roles={1} ) RETURN r as rel, from as from, to as to
 ] for params [[1:[Neo]]</pre>
</div>
</div>
<div class="sect2">
<h3 id="relationshipType">Controlling the Relationship Type</h3>
<div class="paragraph">
<p>You will have noticed from the previous example that the relationship type is <code>CASTMEMBER</code>.</p>
</div>
<div class="paragraph">
<p>By default GORM uses the class name for the relationship type. You can configure an alternative default using the <code>mapping</code> block if necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.neo4j.*</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">grails.neo4j.mapping.MappingBuilder.*</span>

<span class="directive">static</span> mapping = relationship {
   type <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>
   direction Direction.OUTGOING
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example also demonstrates configuring the <code>direction</code> of the relationship.</p>
</div>
<div class="paragraph">
<p>You can also assign a per instance relationship type overriding the default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> castMember = <span class="keyword">new</span> CastMember(
    <span class="key">type</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTED</span><span class="delimiter">&quot;</span></span>
    <span class="key">from</span>: <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Lana Wachowski</span><span class="delimiter">&quot;</span></span>),
    <span class="key">to</span>: <span class="keyword">new</span> Movie(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Matrix</span><span class="delimiter">&quot;</span></span>))
    .save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then later use the type in queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">List</span>&lt;CastMember&gt; directors = CastMember.findAllByType(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTED</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="relationshipType">Querying and Relationships</h3>
<div class="paragraph">
<p>Generally all types of GORM queries work with relationships. There is some special handling for the <code>from</code> and <code>to</code> properties of a relationship to make it possible to query these and use projections.</p>
</div>
<div class="paragraph">
<p>When you query any other property of a relationship the relationship&#8217;s properties are queried. When using <code>from</code> and <code>to</code> however, the nodes that form both ends of the relationship are queried instead.</p>
</div>
<div class="paragraph">
<p>Consider this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">List</span> keanuCastings = CastMember.where {
    from.name == <span class="string"><span class="delimiter">&quot;</span><span class="content">Keanu</span><span class="delimiter">&quot;</span></span>
}.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>where</code> query will produce the following cypher query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MATCH (from:Person)-[r:ACTED_IN]-&gt;(to:Movie) WHERE ( ( from.name={1} ) ) RETURN r as rel, from as from, to</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>from</code> end of the relationship is queried. You can also apply projections to the <code>to</code> and <code>from</code> associations. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">DetachedCriteria&lt;CastMember&gt; baseQuery = CastMember.where {
    from.name == <span class="string"><span class="delimiter">&quot;</span><span class="content">Keanu</span><span class="delimiter">&quot;</span></span>
} <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">int</span> totalKeanuMovies = baseQuery.projections {
    countDistinct(<span class="string"><span class="delimiter">&quot;</span><span class="content">to.title</span><span class="delimiter">&quot;</span></span>)
}.get() <i class="conum" data-value="2"></i><b>(2)</b>

<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keanuMovieTitles = baseQuery.property(<span class="string"><span class="delimiter">'</span><span class="content">to.title</span><span class="delimiter">'</span></span>).list() <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a <code>DetachedCriteria</code> query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use a projection to get the total count of movie titles</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use a project to get only the movie titles</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="querying">Querying with GORM for Neo4j</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for Neo4j supports all the different querying methods provided by GORM including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://grails.github.io/grails-doc/latest/guide/GORM.html#finders">Dynamic Finders</a></p>
</li>
<li>
<p><a href="https://grails.github.io/grails-doc/latest/guide/GORM.html#whereQueries">Where Queries</a></p>
</li>
<li>
<p><a href="https://grails.github.io/grails-doc/latest/guide/GORM.html#criteria">Criteria Queries</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, HQL queries are not supported, instead you can use Cypher directly if you so choose.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to see what queries GORM for Neo4j generates, enabling logging for the <code>org.grails.datastore.gorm.neo4j</code> package
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="lazyLoading">Understanding Lazy Loading</h3>
<div class="paragraph">
<p>When retrieving a GORM entity and its associations by default single-ended associations will only retrieve the association id, whilst associations to many objects will not retrieve the association at all until it is accessed. This is called lazy loading.</p>
</div>
<div class="paragraph">
<p>For example given the following domain model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">League</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">clubs</span>:Club]
}
<span class="type">class</span> <span class="class">Club</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> belongsTo = [<span class="key">league</span>:League]
    <span class="directive">static</span> hasMany = [<span class="key">teams</span>: Team ]
}
<span class="type">class</span> <span class="class">Team</span>  {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> belongsTo = [<span class="key">club</span>:Club]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you retrieve the <code>Club</code> by name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> club = Club.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manchester United</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will get the following Cypher query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (n:Club) WHERE ( ID(n)={1} ) RETURN n as data</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the <code>teams</code> association is not loaded in the query and nor is the <code>league</code> association. Note that if you were to make the <code>league</code> association nullable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Club</span> {
 ...
 static belongsTo = [<span class="key">league</span>:League]
 <span class="directive">static</span> constraints = {
    league <span class="key">nullable</span>:<span class="predefined-constant">true</span>
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would alter the query executed to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (n:Club) WHERE ( ID(n) = {1} )
OPTIONAL MATCH(n)-[:LEAGUE]-&gt;(leagueNode)
RETURN n as data, collect(DISTINCT ID(leagueNode)) as leagueIds</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that only the ID of the <code>league</code> association is retrieved.</p>
</div>
<div class="paragraph">
<p>The reason the <code>id</code> of the associated entity is retrieved is to differentiate between whether an association exists or is <code>null</code>. You can restore the previous behaviour by making the <code>league</code> association <code>lazy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Club</span> {
 ...
 static belongsTo = [<span class="key">league</span>:League]
 <span class="directive">static</span> constraints = {
    league <span class="key">nullable</span>:<span class="predefined-constant">true</span>
 }
 <span class="directive">static</span> mapping = {
    league <span class="key">lazy</span>:<span class="predefined-constant">true</span>
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However if you were to access the <code>league</code> association and it were <code>null</code> you would get an exception.</p>
</div>
<div class="paragraph">
<p>With all of these approaches, if you then iterate over the teams you will get a second query to obtain the teams:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span>(team <span class="keyword">in</span> club.teams) {
    println team.name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query generated will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">MATCH (<span class="key">from</span>:Club)-[:TEAMS]-&gt;(<span class="key">to</span>:Team) WHERE ID(from) = {id} RETURN to <span class="keyword">as</span> data</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to avoid this secondary query to retrieve the data you can do so using an eager query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// using a dynamic finder</span>
<span class="keyword">def</span> club = Club.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manchester United</span><span class="delimiter">&quot;</span></span>, [<span class="key">fetch</span>:[<span class="key">teams</span>:<span class="string"><span class="delimiter">'</span><span class="content">join</span><span class="delimiter">'</span></span>]])

<span class="comment">// using a where queries</span>
<span class="keyword">def</span> query = Club.where { name == <span class="string"><span class="delimiter">&quot;</span><span class="content">Manchester United</span><span class="delimiter">&quot;</span></span> }
                .join(<span class="string"><span class="delimiter">'</span><span class="content">teams</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> club = query.find()

<span class="comment">// using criteria</span>
<span class="keyword">def</span> query = Club.createCriteria()
<span class="keyword">def</span> club = query.get {
    eq <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Manchester United</span><span class="delimiter">&quot;</span></span>
    join <span class="string"><span class="delimiter">'</span><span class="content">teams</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will instead generate the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (n:Club) WHERE ( n.name={1} )
OPTIONAL MATCH(n)-[:TEAMS]-&gt;(teamsNode) WITH n, collect(DISTINCT teamsNode) as teamsNodes
RETURN n as data, teamsNodes</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the associated team nodes are loaded by the query. If you prefer this to happen for every query, then this can also be configured in the mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Club</span> {
    ...

    static mapping = {
       teams <span class="key">fetch</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eager</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also configure the collection ids to be eagerly loaded, but the instances themselves to be lazy loaded via proxies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Club</span> {
    ...

    static mapping = {
       teams <span class="key">fetch</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eager</span><span class="delimiter">&quot;</span></span>, <span class="key">lazy</span>:<span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cypher">Querying with Cypher</h3>
<div class="paragraph">
<p>To query with raw Cypher queries you can use the built in <code>find</code> and <code>findAll</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> club = Club.find(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH n where n.name = {1} RETURN n</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">FC Bayern Muenchen</span><span class="delimiter">'</span></span>)
<span class="keyword">def</span> clubs = Club.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH n where n.name = {1} RETURN n</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">FC Bayern Muenchen</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the first returned item should be the node itself. To execute cypher queries and work with the raw results use <code>executeCypher</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Result</span> result = Club.executeCypher(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH n where n.name = {1} RETURN n</span><span class="delimiter">&quot;</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">FC Bayern Muenchen</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively you can use <code>executeQuery</code> which will return a list of results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">List</span>&lt;Node&gt; nodes = Club.executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH n where n.name = {1} RETURN n</span><span class="delimiter">&quot;</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">FC Bayern Muenchen</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>When working with raw results, you can convert any <code>org.neo4j.driver.types.Node</code> into a domain instance using the <code>as</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Node myNode = ...
 Club club = myNode <span class="keyword">as</span> Club</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This also works for <code>Relationship</code> and <code>Path</code> types
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also convert any <a href="https://neo4j.com/docs/api/java-driver/4.0/org/neo4j/driver/Result.html">org.neo4j.driver.Result</a> instance to a list of domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Result</span> result = ...
List&lt;Club&gt; clubs = result.toList(Club)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="indexing">Defining the Query Index</h3>
<div class="paragraph">
<p>To define which properties of your domain class should be indexed for querying you can do so in the mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Club</span> {
    <span class="predefined-type">String</span> name

    ...
    static mapping = {
        name <span class="key">index</span>:<span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On startup GORM will use Cypher to create indexes as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">CREATE INDEX ON :Club(name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To define a unique index use <code>unique</code> instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Club</span> {
    <span class="predefined-type">String</span> name

    ...
    static mapping = {
        name <span class="key">unique</span>:<span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="paths">Querying for Paths</h3>
<div class="paragraph">
<p>Since 6.1, GORM for Neo4j features support for Neo4j path queries. To use path queries you must implement the <code>grails.neo4j.Node</code> trait in your domain class. For example given the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@EqualsAndHashCode</span>(includes = <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> Node&lt;Person&gt; {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">friends</span>: Person]

    <span class="directive">static</span> mapping = node {
        id(<span class="key">generator</span>:<span class="string"><span class="delimiter">'</span><span class="content">assigned</span><span class="delimiter">'</span></span>, <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following setup data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person joe = <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>)
Person barney = <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Barney</span><span class="delimiter">&quot;</span></span>)
                      .addToFriends(joe)
Person fred = <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>)
                      .addToFriends(barney)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which creates a friend graph it is possible to find out the shortest path from one friend to another with the <code>findShortestPath</code> method which returns a <code>grails.neo4j.Path</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Path&lt;Person, Person&gt; path = Person.findShortestPath(fred, joe, <span class="integer">15</span>)
<span class="keyword">for</span>(Path.Segment&lt;Person, Person&gt; segment <span class="keyword">in</span> path) {
    println segment.start().name
    println segment.end().name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also find the shortest path without first loading the entities using proxies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Path&lt;Person, Person&gt; path = Person.findShortestPath(Person.proxy(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>), Person.proxy(<span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>), <span class="integer">15</span>)
<span class="keyword">for</span>(Path.Segment&lt;Person, Person&gt; segment <span class="keyword">in</span> path) {
    println segment.start().name
    println segment.end().name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally it is also possible to use Cypher queries to find a path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> from = <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
<span class="predefined-type">String</span> to = <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>
Path&lt;Person, Person&gt; path = Person.findPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (from:Person),(to:Person), p = shortestPath((from)-[*..15]-(to)) WHERE from.name = </span><span class="inline"><span class="inline-delimiter">$</span>from</span><span class="content"> AND to.name = </span><span class="inline"><span class="inline-delimiter">$</span>to</span><span class="content"> RETURN p</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">for</span>(Path.Segment&lt;Person, Person&gt; segment <span class="keyword">in</span> path) {
    println segment.start().name
    println segment.end().name
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="queryingRelationships">Querying for Relationships</h3>
<div class="paragraph">
<p>In addition to being able to query for paths since 6.1, GORM for Neo4j features support for Neo4j relationship queries. To use path queries you must implement the <code>grails.neo4j.Node</code> trait in your domain class. For example given the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@EqualsAndHashCode</span>(includes = <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> Node&lt;Person&gt; {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">friends</span>: Person]

    <span class="directive">static</span> mapping = node {
        id(<span class="key">generator</span>:<span class="string"><span class="delimiter">'</span><span class="content">assigned</span><span class="delimiter">'</span></span>, <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find a relationship between two entities with the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> from = <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
<span class="predefined-type">String</span> to = <span class="string"><span class="delimiter">&quot;</span><span class="content">Barney</span><span class="delimiter">&quot;</span></span>
Relationship&lt;Person, Person&gt; rel = Person.findRelationship(Person.proxy(from), Person.proxy(to))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The arguments can be retrieved instances or unloaded proxies to nodes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Querying for relationships in this way is not as flexible as using relationship entities. Consider <a href="#relationships">mapping an entity to a relationship</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also find all the relationships between two entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> from = <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
<span class="predefined-type">String</span> to = <span class="string"><span class="delimiter">&quot;</span><span class="content">Barney</span><span class="delimiter">&quot;</span></span>
<span class="predefined-type">List</span>&lt;Relationship&lt;Person, Person&gt;&gt; rels = Person.findRelationships(Person.proxy(from), Person.proxy(to))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or find all the relationships between two entity types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">List</span>&lt;Relationship&lt;Person, Person&gt;&gt; rels = Person.findRelationships(Person, Person, [<span class="key">max</span>:<span class="integer">10</span>])
<span class="keyword">for</span>(rel <span class="keyword">in</span> rels) {
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Type </span><span class="inline"><span class="inline-delimiter">${</span>rel.type<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    println(<span class="string"><span class="delimiter">&quot;</span><span class="content">From </span><span class="inline"><span class="inline-delimiter">${</span>rel.from.name<span class="inline-delimiter">}</span></span><span class="content"> to </span><span class="inline"><span class="inline-delimiter">${</span>rel.to.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dataServices">GORM for Neo4j Data Services</h3>
<div class="paragraph">
<p>Additional support for <a href="https://gorm.grails.org/6.1.x/hibernate/manual/index.html#dataServices">GORM Data Services</a> exists in GORM for Neo4j beyond what is already offered by GORM core.</p>
</div>
<div class="paragraph">
<p>For example if you declare a data service interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Service</span>(Person)
<span class="type">interface</span> PersonService {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>@Cypher</code> annotation to automatically implement methods that execute Cypher queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Cypher</span>(<span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">MATCH </span><span class="inline"><span class="inline-delimiter">${</span>Person from<span class="inline-delimiter">}</span></span><span class="content">,</span><span class="inline"><span class="inline-delimiter">${</span>Person to<span class="inline-delimiter">}</span></span><span class="content">, p = shortestPath((</span><span class="inline"><span class="inline-delimiter">$</span>from</span><span class="content">)-[*..15]-(</span><span class="inline"><span class="inline-delimiter">$</span>to</span><span class="content">)) 
           WHERE </span><span class="inline"><span class="inline-delimiter">$</span>from</span><span class="content">.name = </span><span class="inline"><span class="inline-delimiter">$</span>start</span><span class="content"> AND </span><span class="inline"><span class="inline-delimiter">$</span>to</span><span class="content">.name = </span><span class="inline"><span class="inline-delimiter">$</span>end</span><span class="content"> 
           RETURN p</span><span class="delimiter">&quot;&quot;&quot;</span></span>)
Path&lt;Person, Person&gt; findPath(<span class="predefined-type">String</span> start, <span class="predefined-type">String</span> end)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how you can use the class names within the Cypher query and it will correctly translate the declaration into the appropriate node <code>MATCH</code> statement.</p>
</div>
<div class="paragraph">
<p>Variable references within the <code>@Cypher</code> string declaration are also compile time checked.</p>
</div>
<div class="paragraph">
<p>You can also automatically implement Cypher update operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Cypher</span>(<span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">MATCH </span><span class="inline"><span class="inline-delimiter">${</span>Person p<span class="inline-delimiter">}</span></span><span class="content"> 
           WHERE </span><span class="inline"><span class="inline-delimiter">$</span>p</span><span class="content">.name = </span><span class="inline"><span class="inline-delimiter">$</span>name</span><span class="content">  
           SET p.age = </span><span class="inline"><span class="inline-delimiter">$</span>age</span><span class="delimiter">&quot;&quot;&quot;</span></span>)
<span class="type">void</span> updatePerson(<span class="predefined-type">String</span> name, <span class="type">int</span> age)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, support for implementing methods that find paths is also possible. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Path&lt;Person, Person&gt; findPath(Person from, Person to)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing">Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is relatively trivial to write unit tests that use GORM for Neo4j. If you wish to use an embedded version of Neo4j simply add the <code>neo4j-harness</code> dependency to your <code>build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testRuntime "org.neo4j.test:neo4j-harness:3.5.35"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create a <a href="https://spockframework.org">Spock</a> specification and declare a <code>@Shared</code> field using the <code>Neo4jDatastore</code> constructor with the domain classes you wish to test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> Neo4jDatastore datastore = <span class="keyword">new</span> Neo4jDatastore(getClass().getPackage())</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>@AutoCleanup</code> annotation will ensure the datastore is shutdown correctly after the test completes
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the test is in the same package as your domain classes then you can also setup package scanning instead of hard coding each domain class name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> Neo4jDatastore datastore
        = <span class="keyword">new</span> Neo4jDatastore(getClass().getPackage())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then annotate each test method with the <code>grails.gorm.transactions.Rollback</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Rollback</span>
<span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multipleDataSources">Multiple Data Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for Neo4j supports the notion of multiple data sources where multiple individual Bolt <code>Driver</code> instances can be configured and switched between.</p>
</div>
<div class="sect2">
<h3 id="_configuring_multiple_bolt_drivers">Configuring Multiple Bolt Drivers</h3>
<div class="paragraph">
<p>To configure multiple Bolt <code>Driver</code> connections you need to use the <code>grails.neo4j.connections</code> setting. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">neo4j</span>:
        <span class="key">url</span>: <span class="string"><span class="content">bolt://localhost:7687</span></span>
        <span class="key">connections</span>:
            <span class="key">moreBooks</span>:
                <span class="key">url</span>: <span class="string"><span class="content">bolt://localhost:7688</span></span>
            <span class="key">evenMoreBooks</span>:
                <span class="key">url</span>: <span class="string"><span class="content">bolt://localhost:7689</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure individual settings for each Bolt driver. If a setting is not specified by default the setting is inherited from the default Neo4j driver.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_domain_classes_to_bolt_drivers">Mapping Domain Classes to Bolt Drivers</h3>
<div class="paragraph">
<p>If a domain class has no specified Neo4j driver connection configuration then the default is used.</p>
</div>
<div class="paragraph">
<p>You can set the <code>connection</code> method in the <code>mapping</code> block to configure an alternate Neo4j Driver.</p>
</div>
<div class="paragraph">
<p>For example, if you want to use the <code>ZipCode</code> domain to use a Neo4j Driver connection called <code>'lookup'</code>, configure it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connection <span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A domain class can also use two or more configured Neo4j Driver connections by using the <code>connections</code> method with a list of names to configure more than one, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connections([<span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">auditing</span><span class="delimiter">'</span></span>])
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a domain class uses the default connection and one or more others, you can use the <code>ConnectionSource.DEFAULT</code> constant to indicate that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.core.connections.*</span>

<span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connections([<span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>, ConnectionSource.DEFAULT])
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a domain class uses all configured <code>DataSource</code> instances use the value <code>ALL</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.core.connections.*</span>

<span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connection ConnectionSource.ALL
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_switching_between_bolt_drivers">Switching between Bolt Drivers</h3>
<div class="paragraph">
<p>You can switch to a different connection at runtime with the <code>withConnection</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.withConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">moreBooks</span><span class="delimiter">&quot;</span></span>) {
    list()
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The call to <code>list()</code> should not be prefixed with <code>Book.</code> as this will use the default connection
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any logic executed within the body of the closure will use the alternate connection. Once the close finishes execution GORM will switch back to the default connection automatically.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multiTenancy">Multi-Tenancy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for Neo4j supports the following multi-tenancy modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DATABASE</code> - A separate database with a separate connection pool is used to store each tenants data.</p>
</li>
<li>
<p><code>DISCRIMINATOR</code> - The same database is used with a discriminator used to partition and isolate data.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuring_multi_tenancy">Configuring Multi Tenancy</h3>
<div class="paragraph">
<p>You can configure Multi-Tenancy the same way described in the <a href="../../hibernate/manual/index.html#multiTenancy">GORM for Hibernate documenation</a>, simply specify a multi tenancy mode and resolver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">gorm</span>:
        <span class="key">multiTenancy</span>:
            <span class="key">mode</span>: <span class="string"><span class="content">DATABASE</span></span>
            <span class="key">tenantResolverClass</span>: <span class="string"><span class="content">org.grails.datastore.mapping.multitenancy.web.SubDomainTenantResolver</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you are using Neo4j and Hibernate together the above configuration will configure both Neo4j <strong>and</strong> Hibernate to use a multi-tenancy mode of <code>DATABASE</code>.</p>
</div>
<div class="paragraph">
<p>If you only want to enable multi-tenancy for Neo4j only you can use the following configuration instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">neo4j</span>:
        <span class="key">multiTenancy</span>:
            <span class="key">mode</span>: <span class="string"><span class="content">DATABASE</span></span>
            <span class="key">tenantResolverClass</span>: <span class="string"><span class="content">org.grails.datastore.mapping.multitenancy.web.SubDomainTenantResolver</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multi_tenancy_modes">Multi Tenancy Modes</h3>
<div class="paragraph">
<p>As mentioned previously, GORM for Neo4j supports the <code>DATABASE</code> and <code>DISCRIMINATOR</code> however there are some considerations to keep in mind.</p>
</div>
<div class="sect3">
<h4 id="_database_per_tenant">Database Per Tenant</h4>
<div class="paragraph">
<p>When using the <code>DATABASE</code> mode, only GORM methods calls are dispatched to the correct tenant. This means the following will use the tenant id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// switches to the correct client based on the tenant id</span>
<span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, going directly through the <code>Driver</code> will not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span> <span class="predefined-type">Driver</span> boltDriver

<span class="comment">// uses the default connection and doesn't resolve the tenant it</span>
boltDriver.session().run(<span class="string"><span class="delimiter">&quot;</span><span class="content">..</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are working directly with the <code>Driver</code> instance you need to make sure you obtain the correct instance. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.multitenancy.*</span>

<span class="annotation">@Autowired</span> Neo4jDatastore neo4jDatastore
...
Driver boltDriver =
        neo4jDatastore.getDatastoreForTenantId(Tenants.currentId())
                      .getBoltDriver()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_partitioned_multi_tenancy">Partitioned Multi-Tenancy</h4>
<div class="paragraph">
<p>When using the <code>DISCRIMINATOR</code> approach, GORM for Neo4j will store a <code>tenantId</code> attribute in each Neo4j node and attempt to partition the data.</p>
</div>
<div class="paragraph">
<p>Once again this works only when using GORM methods and even then there are cases where it will not work if you use native Neo4j interfaces.</p>
</div>
<div class="paragraph">
<p>For example the following works fine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// correctly includes the `tenantId` in the query</span>
<span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>As does this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// works automatically if you include the tenantId in the query</span>
<span class="predefined-type">Book</span>.find(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:Book) WHERE p.title={title} AND p.publisher={tenantId} RETURN p</span><span class="delimiter">&quot;</span></span>, [<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>]<span class="string"><span class="delimiter">&quot;</span><span class="content">)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But this query with throw an exception due to a missing tenant id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.find(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:Book) WHERE p.title={title} RETURN p</span><span class="delimiter">&quot;</span></span>, [<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also if you obtain the driver directly the the tenant id will not be included in the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span> <span class="predefined-type">Driver</span> boltDriver

<span class="comment">// uses the default connection and doesn't resolve the tenant it</span>
boltDriver.session()
          .run(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:Book) WHERE p.title={title} RETURN p</span><span class="delimiter">&quot;</span></span>, [<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>]<span class="string"><span class="delimiter">&quot;</span><span class="content">)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since you are operating directly on the Driver cannot know when you perform a query that should be multi-tenant aware.</p>
</div>
<div class="paragraph">
<p>In this case you will have to ensure to include the <code>tenantId</code> manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">boltDriver.session()
          .run(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:Book) WHERE p.title={title} AND p.publisher={tenantId} RETURN p</span><span class="delimiter">&quot;</span></span>,
                [<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>, <span class="key">tenantId</span>: Tenants.currentId() ])</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the same is true of write operations such as inserts that are done with the native API.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="neo4jEnhancements">Enhancements to Neo4j Java Driver API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for Neo4j contains some enhancements to the Neo4j Bolt Driver API.</p>
</div>
<div class="sect3">
<h4 id="_getting_properties_from_nodes">Getting Properties from Nodes</h4>
<div class="paragraph">
<p>The dot operator can be used to obtain properties from a node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Node node = ...
def value = node.myProperty

<span class="comment">// or</span>

<span class="keyword">def</span> value = node[<span class="string"><span class="delimiter">'</span><span class="content">myProperty</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cast_a_node_to_a_map">Cast a Node to a Map</h4>
<div class="paragraph">
<p>Nodes can be cast to maps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Node node = ...
Map myMap = node <span class="keyword">as</span> <span class="predefined-type">Map</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ref-additional-gorm-methods">Additional Gorm Methods</h3>
<div class="sect3">
<h4 id="ref-additional-gorm-methods-cypher">cypher</h4>
<div class="sect4">
<h5 id="_purpose">Purpose</h5>
<div class="paragraph">
<p>Execute a cypher query.</p>
</div>
</div>
<div class="sect4">
<h5 id="_example">Example</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">setup</span>:
<span class="keyword">def</span> person = <span class="keyword">new</span> Person(<span class="key">firstName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Builder</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">def</span> petType = <span class="keyword">new</span> PetType(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">snake</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">def</span> pet = <span class="keyword">new</span> Pet(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>, <span class="key">type</span>: petType, <span class="key">owner</span>: person)
person.addToPets(pet)
person.save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)
session.clear()

<span class="key">when</span>:
<span class="keyword">def</span> result = person.cypher(<span class="string"><span class="delimiter">&quot;</span><span class="content">start n=node({this}) match n-[:pets]-&gt;m return m</span><span class="delimiter">&quot;</span></span>)

<span class="key">then</span>:
result.iterator().size() == <span class="integer">1</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description">Description</h5>
<div class="paragraph">
<p><code>cypher</code> is invoked on any domain instance and returns a <a href="https://neo4j.com/docs/api/java-driver/4.0/org/neo4j/driver/Result.html">org.neo4j.driver.Result</a></p>
</div>
<div class="paragraph">
<p>The parameters passed are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypher query string. The query string might use a implicit <code>this</code> parameter pointing to the instance&#8217;s node</p>
</li>
<li>
<p>a optional map of cypher parameters</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-additional-gorm-methods-cypherStatic">cypherStatic</h4>
<div class="sect4">
<h5 id="_purpose_2">Purpose</h5>
<div class="paragraph">
<p>Execute a cypher query.</p>
</div>
</div>
<div class="sect4">
<h5 id="_example_2">Example</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">setup</span>:
<span class="keyword">new</span> Person(<span class="key">lastName</span>:<span class="string"><span class="delimiter">'</span><span class="content">person1</span><span class="delimiter">'</span></span>).save()
<span class="keyword">new</span> Person(<span class="key">lastName</span>:<span class="string"><span class="delimiter">'</span><span class="content">person2</span><span class="delimiter">'</span></span>).save()
session.flush()
session.clear()

<span class="key">when</span>:
<span class="keyword">def</span> result = Person.cypherStatic(<span class="string"><span class="delimiter">&quot;</span><span class="content">start n=node({this}) match n-[:INSTANCE]-&gt;m where m.lastName='person1' return m</span><span class="delimiter">&quot;</span></span>)

<span class="key">then</span>:
result.iterator().size()==<span class="integer">1</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_2">Description</h5>
<div class="paragraph">
<p><code>cypherStatic</code> is invoked on any domain class and returns a <a href="https://neo4j.com/docs/api/java-driver/4.0/org/neo4j/driver/Result.html">org.neo4j.driver.Result</a></p>
</div>
<div class="paragraph">
<p>The parameters passed are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypher query string. The query string might use a implicit <code>this</code> parameter pointing to the domain class&#8217;s (aka subreference) node</p>
</li>
<li>
<p>a optional map of cypher parameters</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_schemaless_attributes">Schemaless Attributes</h4>
<div class="sect4">
<h5 id="_purpose_3">Purpose</h5>
<div class="paragraph">
<p>For domain classes mapped by Neo4j you can put and get arbitrary attributes on a instances by using the dot operator or map semantics on the domain instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_example_3">Example</h5>
<div class="paragraph">
<p>A simple domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">Integer</span> age = <span class="integer">0</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_map_semantics">Using Map Semantics</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">when</span>:
<span class="keyword">def</span> person = <span class="keyword">new</span> Person(<span class="key">lastName</span>:<span class="string"><span class="delimiter">'</span><span class="content">person1</span><span class="delimiter">'</span></span>).save()
person[<span class="string"><span class="delimiter">'</span><span class="content">notDeclaredProperty</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">someValue</span><span class="delimiter">'</span></span>   <span class="comment">// n.b. the 'dot' notation is not valid for undeclared properties</span>
person[<span class="string"><span class="delimiter">'</span><span class="content">emptyArray</span><span class="delimiter">'</span></span>] = <span class="type">[]</span>
person[<span class="string"><span class="delimiter">'</span><span class="content">someIntArray</span><span class="delimiter">'</span></span>] = [<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>]
person[<span class="string"><span class="delimiter">'</span><span class="content">someStringArray</span><span class="delimiter">'</span></span>] = [<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]
person[<span class="string"><span class="delimiter">'</span><span class="content">someDoubleArray</span><span class="delimiter">'</span></span>] = [<span class="float">0.9</span>, <span class="float">1.0</span>, <span class="float">1.1</span>]
session.flush()
session.clear()
person = Person.get(person.id)

<span class="key">then</span>:
person[<span class="string"><span class="delimiter">'</span><span class="content">notDeclaredProperty</span><span class="delimiter">'</span></span>] == <span class="string"><span class="delimiter">'</span><span class="content">someValue</span><span class="delimiter">'</span></span>
person[<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>] == <span class="string"><span class="delimiter">'</span><span class="content">person1</span><span class="delimiter">'</span></span>  <span class="comment">// declared properties are also available via map semantics</span>
person[<span class="string"><span class="delimiter">'</span><span class="content">someIntArray</span><span class="delimiter">'</span></span>] == [<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>]
person[<span class="string"><span class="delimiter">'</span><span class="content">someStringArray</span><span class="delimiter">'</span></span>] == [<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]
person[<span class="string"><span class="delimiter">'</span><span class="content">someDoubleArray</span><span class="delimiter">'</span></span>] == [<span class="float">0.9</span>, <span class="float">1.0</span>, <span class="float">1.1</span>]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_dot_operator">Using Dot Operator</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">when</span>:
<span class="keyword">def</span> person = <span class="keyword">new</span> Person(<span class="key">lastName</span>:<span class="string"><span class="delimiter">'</span><span class="content">person1</span><span class="delimiter">'</span></span>).save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)
session.clear()
person = Person.load(person.id)
person.notDeclaredProperty = <span class="string"><span class="delimiter">'</span><span class="content">someValue</span><span class="delimiter">'</span></span>   <span class="comment">// n.b. the 'dot' notation is not valid for undeclared properties</span>
person.emptyArray = <span class="type">[]</span>
person.someIntArray = [<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>]
person.someStringArray = [<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]
person.someDoubleArray= [<span class="float">0.9</span>, <span class="float">1.0</span>, <span class="float">1.1</span>]
session.flush()
session.clear()
person = Person.get(person.id)

<span class="key">then</span>:
person.notDeclaredProperty == <span class="string"><span class="delimiter">'</span><span class="content">someValue</span><span class="delimiter">'</span></span>
person.lastName == <span class="string"><span class="delimiter">'</span><span class="content">person1</span><span class="delimiter">'</span></span>  <span class="comment">// declared properties are also available via map semantics</span>
person.someIntArray == [<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>]
person.someStringArray == [<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>]
person.emptyArray == <span class="type">[]</span>
person.someDoubleArray == [<span class="float">0.9</span>, <span class="float">1.0</span>, <span class="float">1.1</span>]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_3">Description</h5>
<div class="paragraph">
<p>The non declared attribtes are stored a regular properties on the domain instance&#8217;s node. The values of the schemaless attributes must be a valid type for Neo4j property (String, primitives and arrays of the former two).</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 8.1.0<br>
</div>
</div>
</body>
</html>