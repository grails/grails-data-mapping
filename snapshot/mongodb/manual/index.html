<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Graeme Rocher, Burt Beckwith, Puneet Behl">
<title>GORM for MongoDB</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>GORM for MongoDB</h1>
<div class="details">
<span id="author" class="author">Graeme Rocher, Burt Beckwith, Puneet Behl</span><br>
<span id="revnumber">version 8.0.0-SNAPSHOT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#compatibility">Compatibility with GORM for Hibernate</a></li>
<li><a href="#releaseNotes">Release Notes</a></li>
<li><a href="#upgradeNotes">Upgrade Notes</a></li>
</ul>
</li>
<li><a href="#gettingStarted">Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_basic_setup">Basic Setup</a></li>
<li><a href="#_common_errors">Common Errors</a></li>
<li><a href="#_configuring_mongodb">Configuring MongoDB</a></li>
<li><a href="#mongoOnly">Using MongoDB Standalone</a></li>
<li><a href="#withHibernate">Combining MongoDB and Hibernate</a></li>
<li><a href="#advancedConfig">Advanced Configuration</a></li>
<li><a href="#springBoot">Using GORM in Spring Boot</a></li>
<li><a href="#outsideGrails">GORM for MongoDB without Grails</a></li>
</ul>
</li>
<li><a href="#objectMapping">Mapping Domain Classes</a>
<ul class="sectlevel3">
<li><a href="#_basic_mapping">Basic Mapping</a></li>
<li><a href="#_embedded_documents">Embedded Documents</a></li>
<li><a href="#_basic_collection_types">Basic Collection Types</a></li>
<li><a href="#_customized_collection_and_database_mapping">Customized Collection and Database Mapping</a></li>
<li><a href="#idGeneration">Identity Generation</a></li>
<li><a href="#dirtyChecking">Understanding Dirty Checking</a></li>
<li><a href="#queryIndexes">Querying Indexing</a></li>
<li><a href="#writeConcern">Customizing the WriteConcern</a></li>
<li><a href="#dynamicAttributes">Dynamic Attributes</a></li>
<li><a href="#customTypes">Custom User Types</a></li>
</ul>
</li>
<li><a href="#querying">Querying</a>
<ul class="sectlevel2">
<li><a href="#queryingBasicsl">Basic Querying</a></li>
<li><a href="#geoSpatial">Geospacial Querying</a></li>
<li><a href="#textSearch">Full Text Search</a></li>
</ul>
</li>
<li><a href="#multipleDataSources">Multiple Data Sources</a>
<ul class="sectlevel2">
<li><a href="#_configuring_multiple_mongo_clients">Configuring Multiple Mongo Clients</a></li>
<li><a href="#_mapping_domain_classes_to_mongo_clients">Mapping Domain Classes to Mongo Clients</a></li>
<li><a href="#_switching_between_mongo_clients">Switching between Mongo Clients</a></li>
<li><a href="#connectionSources">The ConnectionSources API</a></li>
</ul>
</li>
<li><a href="#databaseSwitching">Switching Database or Collection at Runtime</a></li>
<li><a href="#multiTenancy">Multi-Tenancy</a>
<ul class="sectlevel2">
<li><a href="#_configuring_multi_tenancy">Configuring Multi Tenancy</a></li>
<li><a href="#_multi_tenancy_transformations">Multi-Tenancy Transformations</a></li>
<li><a href="#_multi_tenancy_modes">Multi Tenancy Modes</a></li>
<li><a href="#_dynamic_connectionsources">Dynamic ConnectionSources</a></li>
</ul>
</li>
<li><a href="#stateless">Stateless Mode</a>
<ul class="sectlevel3">
<li><a href="#_stateful_mode">Stateful mode</a></li>
<li><a href="#_stateless_domain_classes">Stateless Domain classes</a></li>
<li><a href="#_disadvantages_of_stateless_mode">Disadvantages of Stateless Mode</a></li>
</ul>
</li>
<li><a href="#lowLevelApi">Using the MongoDB Driver Directly</a></li>
<li><a href="#transactions">Transactions</a></li>
<li><a href="#testing">Unit Testing</a></li>
<li><a href="#_integration_testing">Integration Testing</a></li>
<li><a href="#reference">Reference</a>
<ul class="sectlevel2">
<li><a href="#ref-beans">Beans</a></li>
<li><a href="#ref-domain-classes">Domain Classes</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MongoDB bridges the gap between key-value stores (which are fast and highly scalable) and traditional RDBMS systems (which provide rich queries and deep functionality).</p>
</div>
<div class="paragraph">
<p>MongoDB (from "humongous") is a scalable, high-performance, open source, document-oriented database.</p>
</div>
<div class="paragraph">
<p>This project aims to provide an object-mapping layer on top of Mongo to ease common activities such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marshalling from Mongo to Groovy/Java types and back again</p>
</li>
<li>
<p>Support for GORM dynamic finders, criteria and named queries</p>
</li>
<li>
<p>Session-managed transactions</p>
</li>
<li>
<p>Validating domain instances backed by the Mongo datastore</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="compatibility">Compatibility with GORM for Hibernate</h3>
<div class="paragraph">
<p>This implementation tries to be as compatible as possible with GORM for Hibernate. In general you can refer to the <a href="https://grails.org/doc/latest/guide/5.%20Object%20Relational%20Mapping%20(GORM).html">GORM documentation</a> and the "Domain Classes" section of the <a href="https://grails.org/doc/latest/">reference guide</a> (see the right nav) for usage information.</p>
</div>
<div class="paragraph">
<p>The following key features are supported by GORM for Mongo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simple persistence methods</p>
</li>
<li>
<p>Dynamic finders</p>
</li>
<li>
<p>Criteria queries</p>
</li>
<li>
<p>Named queries</p>
</li>
<li>
<p>Inheritance</p>
</li>
<li>
<p>Embedded types</p>
</li>
<li>
<p>Query by example</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, some features are not supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HQL queries</p>
</li>
<li>
<p>Composite primary keys</p>
</li>
<li>
<p>Many-to-many associations (these can be modelled with a mapping class)</p>
</li>
<li>
<p>Any direct interaction with the Hibernate API</p>
</li>
<li>
<p>Custom Hibernate user types (custom types are allowed with a different API)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There may be other limitations not mentioned here so in general it shouldn&#8217;t be expected that an application based on GORM for Hibernate will "just work" without some tweaking involved. Having said that, the large majority of common GORM functionality is supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="releaseNotes">Release Notes</h3>
<div class="paragraph">
<p>Below are the details of the changes across releases:</p>
</div>
<div class="sect3">
<h4 id="_7_1">7.1</h4>
<div class="ulist">
<ul>
<li>
<p>Support Apache Groovy 3, and Java 14</p>
</li>
<li>
<p>Upgrade to mongodb-driver-sync 4.3.3</p>
</li>
<li>
<p>Autowire bean by type in the Data Service</p>
</li>
<li>
<p>Compatible only with Grails 5</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_7_0">7.0</h4>
<div class="ulist">
<ul>
<li>
<p>Support for MongoDB Driver 3.10.0</p>
</li>
<li>
<p>Support for Java 11</p>
</li>
<li>
<p>Removal of RxJava 1.x Module</p>
</li>
<li>
<p>Java 8 Minimum</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_6_1">6.1</h4>
<div class="ulist">
<ul>
<li>
<p>GORM Data Services Support</p>
</li>
<li>
<p>Package Scanning Constructors</p>
</li>
<li>
<p>Decimal128 Type Support</p>
</li>
<li>
<p>MongoDB 3.4.x Java Driver Support</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_6_0">6.0</h4>
<div class="ulist">
<ul>
<li>
<p>Multiple Data Sources Support</p>
</li>
<li>
<p>Multi Tenancy Support</p>
</li>
<li>
<p>RxGORM for MongoDB (Using MongoDB Rx Drivers)</p>
</li>
<li>
<p>Unified Configuration model</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_5_0">5.0</h4>
<div class="ulist">
<ul>
<li>
<p>MongoDB 3.x driver support</p>
</li>
<li>
<p>New Codec Persistence Engine</p>
</li>
<li>
<p>Removal of GMongo</p>
</li>
<li>
<p>Trait based</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_4_0">4.0</h4>
<div class="ulist">
<ul>
<li>
<p>Grails 3 compatibility</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_3_0">3.0</h4>
<div class="ulist">
<ul>
<li>
<p>Support for MongoDB 2.6</p>
</li>
<li>
<p>MongoDB 2.6 GeoJSON type support (<code>MultiPoint</code>, <code>MultiLineString</code>, <code>MultiPolygon</code> and <code>GeometryCollection</code>)</p>
</li>
<li>
<p>Support for Maps of embedded entities</p>
</li>
<li>
<p>Flexible index definition</p>
</li>
<li>
<p>Full text search support</p>
</li>
<li>
<p>Support for projections using MongoDB aggregation</p>
</li>
<li>
<p>Size related criteria implemented (<code>sizeEq</code>, <code>sizeLt</code> etc.) on collections</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_2_0">2.0</h4>
<div class="ulist">
<ul>
<li>
<p>GeoJSON shape support</p>
</li>
<li>
<p>Support for SSL connections</p>
</li>
<li>
<p>Support for MongoDB connection strings</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_3">1.3</h4>
<div class="ulist">
<ul>
<li>
<p>Support for stateless mode to improve read performance</p>
</li>
<li>
<p>Support for dynamically switching which database or collection to persist to at runtime</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_2">1.2</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
MongoDB plugin 1.2 and above requires Grails 2.1.5 or 2.2.1 as a minimum Grails version, if you are using older versions of Grails you will need to stay with 1.1
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_1_1_ga">1.1 GA</h4>
<div class="ulist">
<ul>
<li>
<p>DBRefs no longer used by default for associations</p>
</li>
<li>
<p>Upgrade to GMongo 1.0 and Spring Data MongoDB 1.1</p>
</li>
<li>
<p>Support for global mapping configuration</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_ga">1.0 GA</h4>
<div class="ulist">
<ul>
<li>
<p>Initial feature complete 1.0 release</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgradeNotes">Upgrade Notes</h3>
<div class="sect3">
<h4 id="_dependency_upgrades">Dependency Upgrades</h4>
<div class="paragraph">
<p>GORM 7.1 supports Apache Groovy 3, Java 14, MongoDB Driver 4.3 and Spring 5.3.x.</p>
</div>
<div class="paragraph">
<p>Each of these underlying components may have changes that require altering your application. These changes are beyond the scope of this documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_default_autowire_by_type_inside_gorm_data_services">Default Autowire By Type inside GORM Data Services</h4>
<div class="paragraph">
<p>A Grails Service (or a bean) inside GORM DataService will default to autowire by-type, For example:</p>
</div>
<div class="paragraph">
<p><em>./grails-app/services/example/BookService.groovy</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>package example

import grails.gorm.services.Service

@Service(Book)
abstract class BookService {

    TestService testRepo

    abstract Book save(String title, String author)

    void doSomething() {
        assert testRepo != null
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that with autowire by-type as the default, when multiple beans for same type are found the application with throw Exception. Use the Spring `@Qualifier annotation for <a href="https://docs.spring.io/spring-framework/docs/5.3.10/reference/html/core.html#beans-autowired-annotation-qualifiers">Fine-tuning Annotation Based Autowiring with Qualifiers</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gettingStarted">Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basic_setup">Basic Setup</h3>
<div class="paragraph">
<p>To get started with GORM for MongoDB within Grails you need configure it as a dependency in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile 'org.grails.plugins:mongodb:8.0.0-SNAPSHOT'
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_common_errors">Common Errors</h3>
<div class="paragraph">
<p>If you receive an error that indicates a failure to resolve the <code>grails-datastore-simple</code> dependency you may need to add the following to <code>build.gradle</code> directly above the <code>dependencies</code> block:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations.all {
    exclude <span class="key">module</span>:<span class="string"><span class="delimiter">'</span><span class="content">grails-datastore-simple</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you receive an error at runtime such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Caused <span class="key">by</span>: org.bson.codecs.configuration.CodecConfigurationException: Can<span class="string"><span class="delimiter">'</span><span class="content">t find a codec for class org.bson.BsonDecimal128.</span></span><span class="error">
</span>        at org.bson.codecs.configuration.CodecCache.getOrThrow(CodecCache.java:<span class="integer">46</span>)
        at org.bson.codecs.configuration.ProvidersCodecRegistry.get(ProvidersCodecRegistry.java:<span class="integer">63</span>)
        at org.bson.codecs.configuration.ChildCodecRegistry.get(ChildCodecRegistry.java:<span class="integer">51</span>)
        at org.bson.codecs.BsonTypeCodecMap.&lt;init&gt;(BsonTypeCodecMap.java:<span class="integer">44</span>)
        at org.bson.codecs.BsonDocumentCodec.&lt;init&gt;(BsonDocumentCodec.java:<span class="integer">65</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It means you have an older version of the MongoDB Java driver on your classpath and you should add the following declaration to <code>build.gradle</code> to ensure the dependency is correct:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile "org.mongodb:mongodb-driver:4.5.0"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_mongodb">Configuring MongoDB</h3>
<div class="paragraph">
<p>With that done you need to set up a running MongoDB server. Refer to the <a href="https://docs.mongodb.com/getting-started/shell/">MongoDB Documentation</a> for an explanation on how to startup a MongoDB instance. Once installed, starting MongoDB is typically a matter of executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">MONGO_HOME/bin/mongod</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above command executed in a terminal window you should see output like the following appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.073</span>+<span class="octal">0100</span> I JOURNAL  &lt;&lt;initandlisten&gt;&gt; journal dir=<span class="regexp"><span class="delimiter">/</span><span class="content">data</span><span class="delimiter">/</span></span>db/journal
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.073</span>+<span class="octal">0100</span> I JOURNAL  &lt;&lt;initandlisten&gt;&gt; recover : no journal files present, no recovery needed
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I JOURNAL  &lt;&lt;durability&gt;&gt; Durability thread started
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I JOURNAL  &lt;&lt;journal writer&gt;&gt; Journal writer thread started
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; MongoDB starting : pid=<span class="integer">52540</span> port=<span class="integer">27017</span> dbpath=<span class="regexp"><span class="delimiter">/</span><span class="content">data</span><span class="delimiter">/</span></span>db <span class="integer">64</span>-bit host=Graemes-iMac.local
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; ** <span class="key">WARNING</span>: You are running <span class="local-variable">this</span> process <span class="keyword">as</span> the root user, which is not recommended.
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt;
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt;
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; ** <span class="key">WARNING</span>: soft rlimits too low. Number of files is <span class="integer">256</span>, should be at least <span class="integer">1000</span>
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; db version v3<span class="float">.0</span><span class="float">.4</span>
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; git <span class="key">version</span>: <span class="integer">0481</span>c958daeb2969800511e7475dc66986fa9ed5
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; build <span class="key">info</span>: Darwin mci-osx108-<span class="integer">11</span>.build<span class="float">.10</span>gen.cc <span class="float">12.5</span><span class="float">.0</span> Darwin <span class="predefined-type">Kernel</span> Version <span class="float">12.5</span><span class="float">.0</span>: Sun Sep <span class="integer">29</span> <span class="integer">13</span>:<span class="integer">33</span>:<span class="integer">47</span> PDT <span class="integer">2013</span>; <span class="key">root</span>:xnu-<span class="float">2050.48</span><span class="float">.12</span>~<span class="integer">1</span>/RELEASE_X86_64 x86_64 BOOST_LIB_VERSION=<span class="integer">1</span>_49
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; <span class="key">allocator</span>: system
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.090</span>+<span class="octal">0100</span> I CONTROL  &lt;&lt;initandlisten&gt;&gt; <span class="key">options</span>: {}
<span class="integer">2015</span>-<span class="integer">11</span>-<span class="integer">18</span><span class="key">T19</span>:<span class="integer">38</span>:<span class="float">50.176</span>+<span class="octal">0100</span> I NETWORK  &lt;&lt;initandlisten&gt;&gt; waiting <span class="keyword">for</span> connections on port <span class="integer">27017</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the server is running on port 27017, but don&#8217;t worry the MongoDB plugin for Grails will automatically configure itself to look for MongoDB on that port by default.</p>
</div>
<div class="paragraph">
<p>If you want to configure how Grails connects to MongoDB then you can do so using the following settings in <code>grails-app/conf/application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">mongodb</span>:
        <span class="key">host</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
        <span class="key">port</span>: <span class="integer">27017</span>
        <span class="key">username</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">blah</span><span class="delimiter">&quot;</span></span>
        <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">blah</span><span class="delimiter">&quot;</span></span>
        <span class="key">databaseName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mongoOnly">Using MongoDB Standalone</h3>
<div class="paragraph">
<p>If you plan to use MongoDB as your primary datastore then you need to remove the Hibernate plugin from the <code>build.gradle</code> file by commenting out the hibernate line in the plugins block</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:hibernate</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this done all domain classes in grails-app/domain will be persisted via MongoDB and not Hibernate. You can create a domain class by running the regular <code>create-domain-class</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-domain-<span class="type">class</span> <span class="class">Person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Person</code> domain class will automatically be a persistent entity that can be stored in MongoDB.</p>
</div>
</div>
<div class="sect2">
<h3 id="withHibernate">Combining MongoDB and Hibernate</h3>
<div class="paragraph">
<p>If you have both the Hibernate and Mongo plugins installed then by default all classes in the <code>grails-app/domain</code> directory will be persisted by Hibernate and not Mongo. If you want to persist a particular domain class with Mongo then you must use the <code>mapWith</code> property in the domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mapWith = <span class="string"><span class="delimiter">&quot;</span><span class="content">mongo</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advancedConfig">Advanced Configuration</h3>
<div class="sect3">
<h4 id="_mongo_database_connection_configuration">Mongo Database Connection Configuration</h4>
<div class="paragraph">
<p>As mentioned the GORM for MongoDB plugin will configure all the defaults for you, but if you wish to customize those defaults you can do so in the <code>grails-app/conf/application.groovy</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    mongodb {
        host = <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
        port = <span class="integer">27017</span>
        username = <span class="string"><span class="delimiter">&quot;</span><span class="content">blah</span><span class="delimiter">&quot;</span></span>
        password = <span class="string"><span class="delimiter">&quot;</span><span class="content">blah</span><span class="delimiter">&quot;</span></span>
        databaseName = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>databaseName</code> setting configures the default database name. If not specified the <code>databaseName</code> will default to the name of your application.</p>
</div>
<div class="paragraph">
<p>You can also customize the MongoDB connection settings using an <code>options</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    mongodb {
        options {
            autoConnectRetry = <span class="predefined-constant">true</span>
            connectTimeout = <span class="integer">300</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Available options and their descriptions are defined in the <a href="https://api.mongodb.org/java/current/com/mongodb/MongoClientOptions.html">MongoClientOptions</a> javadoc.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mongodb_connection_strings">MongoDB Connection Strings</h4>
<div class="paragraph">
<p>Since 2.0, you can also use MongoDB <a href="https://docs.mongodb.org/manual/reference/connection-string/">connection strings</a> to configure the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    mongodb {
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">mongodb://localhost/mydb</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using MongoDB connection strings is currently the most flexible and recommended way to configure MongoDB connections.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_options_guide">Configuration Options Guide</h4>
<div class="paragraph">
<p>Below is a complete example showing all configuration options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    mongodb {
        databaseName = <span class="string"><span class="delimiter">&quot;</span><span class="content">myDb</span><span class="delimiter">&quot;</span></span> <span class="comment">// the default database name</span>
        host = <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span> <span class="comment">// the host to connect to</span>
        port = <span class="integer">27017</span> <span class="comment">// the port to connect to</span>
        username = <span class="string"><span class="delimiter">&quot;</span><span class="content">..</span><span class="delimiter">&quot;</span></span> <span class="comment">// the username to connect with</span>
        password = <span class="string"><span class="delimiter">&quot;</span><span class="content">..</span><span class="delimiter">&quot;</span></span> <span class="comment">// the password to connect with</span>
        stateless = <span class="predefined-constant">false</span> <span class="comment">// whether to use stateless sessions by default</span>

        <span class="comment">// Alternatively, using  'url'</span>
        <span class="comment">// url = &quot;mongodb://localhost/mydb&quot;</span>

        options {
            connectionsPerHost = <span class="integer">10</span> <span class="comment">// The maximum number of connections allowed per host</span>
            threadsAllowedToBlockForConnectionMultiplier = <span class="integer">5</span>
            maxWaitTime = <span class="integer">120000</span> <span class="comment">// Max wait time of a blocking thread for a connection.</span>
            connectTimeout = <span class="integer">0</span> <span class="comment">// The connect timeout in milliseconds. 0 == infinite</span>
            socketTimeout = <span class="integer">0</span> <span class="comment">// The socket timeout. 0 == infinite</span>
            socketKeepAlive = <span class="predefined-constant">false</span> <span class="comment">// Whether or not to have socket keep alive turned on</span>
            writeConcern = <span class="keyword">new</span> com.mongodb.WriteConcern(<span class="integer">0</span>, <span class="integer">0</span>, <span class="predefined-constant">false</span>) <span class="comment">// Specifies the number of servers to wait for on the write operation, and exception raising behavior</span>
            sslEnabled = <span class="predefined-constant">false</span> <span class="comment">// Specifies if the driver should use an SSL connection to Mongo</span>
            socketFactory = ... <span class="comment">// Specifies the SocketFactory to use for creating connections</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_global_mapping_configuration">Global Mapping Configuration</h4>
<div class="paragraph">
<p>Using the <code>grails.mongodb.default.mapping</code> setting in <code>grails-app/conf/application.groovy</code> you can configure global mapping options across your domain classes. This is useful if, for example, you want to disable optimistic locking globally or you wish to use <code>DBRefs</code> in your association mappings. For example, the following configuration will disable optimistic locking globally and use <code>DBRefs</code> for all properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.mongodb.default.mapping = {
    version <span class="predefined-constant">false</span>
    <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>(<span class="key">reference</span>:<span class="predefined-constant">true</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>*</code> method is used to indicate that the setting applies to all properties.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springBoot">Using GORM in Spring Boot</h3>
<div class="paragraph">
<p>To use GORM for MongoDB in Spring Boot add the necessary dependencies to your Boot application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile("org.grails:gorm-mongodb-spring-boot:8.0.0-SNAPSHOT")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure your Boot <code>Application</code> class is annotated with <code>ComponentScan</code>, example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.*</span>

<span class="annotation">@Configuration</span>
<span class="annotation">@EnableAutoConfiguration</span>
<span class="annotation">@ComponentScan</span>
<span class="type">class</span> <span class="class">Application</span> {
    <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run Application, args
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>ComponentScan</code> without a value results in Boot scanning for classes in the same package or any package nested within the <code>Application</code> class package.
If your GORM entities are in a different package specify the package name as the value of the <code>ComponentScan</code> annotation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally create your GORM entities and ensure they are annotated with <code>grails.persistence.Entity</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.persistence.*</span>

<span class="annotation">@Entity</span>
<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="outsideGrails">GORM for MongoDB without Grails</h3>
<div class="paragraph">
<p>If you wish to use GORM for MongoDB outside of a Grails application you should declare the necessary dependencies, for example in Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile "org.grails:grails-datastore-gorm-mongodb:8.0.0-SNAPSHOT"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then annotate your entities with the <code>grails.gorm.annotation.Entity</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Entity</span>
<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to place the bootstrap logic somewhere in the loading sequence of your application which uses <code>MongoDatastore</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> datastore = <span class="keyword">new</span> MongoDatastore(Person)

println Person.count()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For configuration you can either pass a map or an instance of the <code>org.springframework.core.env.PropertyResolver</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> initializer = <span class="keyword">new</span> MongoDatastore([<span class="string"><span class="delimiter">'</span><span class="content">grails.mongodb.url</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">http://myserver</span><span class="delimiter">'</span></span>], Person)

println Person.count()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Spring with an existing <code>ApplicationContext</code> you can instead call <code>MongoDbDataStoreSpringInitializer.configureForBeanDefinitionRegistry</code> prior to refreshing the context. You can pass the Spring <code>Environment</code> object to the constructor for configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext myApplicationContext = ...
def initializer = <span class="keyword">new</span> MongoDbDataStoreSpringInitializer(myApplicationContext.getEnvironment(), Person)
initializer.configureForBeanDefinitionRegistry(myApplicationContext)

println Person.count()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="objectMapping">Mapping Domain Classes</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_basic_mapping">Basic Mapping</h4>
<div class="paragraph">
<p>The way GORM for MongoDB works is to map each domain class to a Mongo collection. For example given a domain class such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="directive">static</span> hasMany = [<span class="key">pets</span>:Pet]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will map onto a MongoDB <a href="https://api.mongodb.org/java/current/com/mongodb/client/MongoCollection.html">Collection</a> called "person".</p>
</div>
</div>
<div class="sect3">
<h4 id="_embedded_documents">Embedded Documents</h4>
<div class="paragraph">
<p>It is quite common in MongoDB to embed documents within documents (nested documents). This can be done with GORM embedded types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    Address address
    <span class="directive">static</span> embedded = [<span class="string"><span class="delimiter">'</span><span class="content">address</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can map embedded lists and sets of documents/domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    Address address
    <span class="predefined-type">List</span> otherAddresses
    <span class="directive">static</span> embedded = [<span class="string"><span class="delimiter">'</span><span class="content">address</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">otherAddresses</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also embed maps of embedded classes where the keys are strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,Address&gt; addresses
    <span class="directive">static</span> embedded = [<span class="string"><span class="delimiter">'</span><span class="content">addresses</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_basic_collection_types">Basic Collection Types</h4>
<div class="paragraph">
<p>You can also map lists and maps of basic types (such as strings) simply by defining the appropriate collection type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; friends
    <span class="predefined-type">Map</span> pets
}

...

new Person(<span class="key">friends</span>:[<span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Bob</span><span class="delimiter">'</span></span>], <span class="key">pets</span>:[<span class="key">chuck</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Dog</span><span class="delimiter">&quot;</span></span>, <span class="key">eddie</span>:<span class="string"><span class="delimiter">'</span><span class="content">Parrot</span><span class="delimiter">'</span></span>]).save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Basic collection types are stored as native ArrayList and BSON documents within the Mongo documents.</p>
</div>
</div>
<div class="sect3">
<h4 id="_customized_collection_and_database_mapping">Customized Collection and Database Mapping</h4>
<div class="paragraph">
<p>You may wish to customize how a domain class maps onto a <code>MongoCollection</code>. This is possible using the <code>mapping</code> block as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ..
    <span class="directive">static</span> mapping = {
        collection <span class="string"><span class="delimiter">&quot;</span><span class="content">mycollection</span><span class="delimiter">&quot;</span></span>
        database <span class="string"><span class="delimiter">&quot;</span><span class="content">mydb</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we see that the <code>Person</code> entity has been mapped to a collection called "mycollection" in a database called "mydb".</p>
</div>
<div class="paragraph">
<p>You can also control how an individual property maps onto a Mongo Document field (the default is to use the property name itself):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ..
    <span class="directive">static</span> mapping = {
        firstName <span class="key">attr</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">first_name</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using the mapping engine, for non-embedded associations by default GORM for MongoDB will map links between documents using MongoDB <a href="https://docs.mongodb.org/manual/reference/database-references/">database references</a> also known as <code>DBRefs</code>.</p>
</div>
<div class="paragraph">
<p>If you prefer not to use DBRefs then you tell GORM to use direct links by using the <code>reference:false</code> mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ..
    <span class="directive">static</span> mapping = {
        address <span class="key">reference</span>:<span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="idGeneration">Identity Generation</h3>
<div class="paragraph">
<p>By default in GORM entities are supplied with an integer-based identifier. So for example the following entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Has a property called <code>id</code> of type <code>java.lang.Long</code>. In this case GORM for Mongo will generate a sequence based identifier using the technique <a href="https://docs.mongodb.org/manual/tutorial/isolate-sequence-of-operations/">described in the Mongo documentation</a> on Atomic operations.</p>
</div>
<div class="paragraph">
<p>However, sequence based integer identifiers are not ideal for environments that require <a href="https://docs.mongodb.org/manual/sharding/">sharding</a> (one of the nicer features of Mongo). Hence it is generally advised to use either String based ids:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> id
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or a native BSON <a href="https://api.mongodb.org/java/current/org/bson/types/ObjectId.html">ObjectId</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.bson.types.ObjectId</span>

<span class="type">class</span> <span class="class">Person</span> {
    ObjectId id
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>BSON <code>ObjectId</code> instances are generated in a similar fashion to <code>UUIDs</code>.</p>
</div>
<div class="sect3">
<h4 id="_assigned_identifiers">Assigned Identifiers</h4>
<div class="paragraph">
<p>Note that if you manually assign an identifier, then you will need to use the <code>insert</code> method instead of the <code>save</code> method, otherwise GORM can&#8217;t work out whether you are trying to achieve an insert or an update. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> id
}
...
Person p = <span class="keyword">new</span> Person()
p.id = <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
<span class="comment">// to insert</span>
p.insert()
<span class="comment">// to update</span>
p.save()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dirtyChecking">Understanding Dirty Checking</h3>
<div class="paragraph">
<p>In order to be as efficient as possible when it comes to generating updates GORM for MongoDb will track changes you make to persistent instances.</p>
</div>
<div class="paragraph">
<p>When an object is updated only the properties or associations that have changed will be updated.</p>
</div>
<div class="paragraph">
<p>You can check whether a given property has changed by using the <code>hasChanged</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span>( person.hasChanged(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>) ) {
   <span class="comment">// do something</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is defined by the <code>org.grails.datastore.mapping.dirty.checking.DirtyCheckable</code> trait.</p>
</div>
<div class="paragraph">
<p>In the case of collections and association types GORM for MongoDB will wrap each collection in a dirty checking aware
collection type.</p>
</div>
<div class="paragraph">
<p>One of the implications of this is if you override the collection with a non-dirty checking aware type it can disable
dirty checking and prevent the property from being updated.</p>
</div>
<div class="paragraph">
<p>If any of your updates are not updating the properties that you anticipate you can force an update using the <a href="../api/org/grails/datastore/mapping/dirty/checking/DirtyCheckable.html#markDirty(java.lang.String)">markDirty()</a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">person.markDirty(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will force GORM for MongoDB to issue an update for the given property name.</p>
</div>
<div class="sect3">
<h4 id="_dirty_checking_and_proxies">Dirty Checking and Proxies</h4>
<div class="paragraph">
<p>Dirty checking uses the <code>equals()</code> method to determine if a property has changed. In the case of associations, it is important to recognize that if the association is a proxy, comparing properties on the domain that are not related to the identifier will initialize the proxy, causing another database query.</p>
</div>
<div class="paragraph">
<p>If the association does not define <code>equals()</code> method, then the default Groovy behavior of verifying the instances are the same will be used. Because proxies are not the same instance as an instance loaded from the database, which can cause confusing behavior. It is recommended to implement the <code>equals()</code> method if you need to check the dirtiness of an association. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">String</span> name

     <span class="comment">/**
     * This ensures that if either or both of the instances
     * have a null id (new instances), they are not equal.
     */</span>
    <span class="annotation">@Override</span>
    <span class="type">boolean</span> equals(o) {
        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Author)) <span class="keyword">return</span> <span class="predefined-constant">false</span>
        <span class="keyword">if</span> (<span class="local-variable">this</span>.is(o)) <span class="keyword">return</span> <span class="predefined-constant">true</span>
        Author that = (Author) o
        <span class="keyword">if</span> (id !=<span class="predefined-constant">null</span> &amp;&amp; that.id !=<span class="predefined-constant">null</span>) <span class="keyword">return</span> id == that.id
        <span class="keyword">return</span> <span class="predefined-constant">false</span>
    }
}

<span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">String</span> title
    Author author
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="queryIndexes">Querying Indexing</h3>
<div class="sect3">
<h4 id="_basics">Basics</h4>
<div class="paragraph">
<p>MongoDB doesn&#8217;t require that you specify indices to query, but like a relational database without specifying indices your queries will be significantly slower.</p>
</div>
<div class="paragraph">
<p>With that in mind it is important to specify the properties you plan to query using the mapping block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> mapping = {
        name <span class="key">index</span>:<span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above mapping a MongoDB index will be automatically created for you. You can customize the index options using the <code>indexAttributes</code> configuration parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> mapping = {
        name <span class="key">index</span>:<span class="predefined-constant">true</span>, <span class="key">indexAttributes</span>: [<span class="key">unique</span>:<span class="predefined-constant">true</span>, <span class="key">dropDups</span>:<span class="predefined-constant">true</span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use MongoDB <a href="https://docs.mongodb.org/manual/reference/operator/meta/hint/">Query Hints</a> by passing the <code>hint</code> argument to any dynamic finder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> people = Person.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, [<span class="key">hint</span>:[<span class="key">name</span>:<span class="integer">1</span>]])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in a criteria query using the query "arguments" method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person.withCriteria {
        eq <span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Bob</span><span class="delimiter">'</span></span>
    arguments <span class="key">hint</span>:[<span class="integer">1</span>][firstName] }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compound_indices">Compound Indices</h4>
<div class="paragraph">
<p>MongoDB supports the notion of <a href="https://docs.mongodb.org/manual/core/index-compound/">compound keys</a>. GORM for MongoDB enables this feature at the mapping level using the <code>compoundIndex</code> mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        compoundIndex <span class="key">name</span>:<span class="integer">1</span>, <span class="key">age</span>:-<span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As per the MongoDB docs 1 is for ascending and -1 is for descending.</p>
</div>
</div>
<div class="sect3">
<h4 id="_indexing_using_the_index_method">Indexing using the <em>index</em> method</h4>
<div class="paragraph">
<p>In addition to the convenience features described above you can use the <code>index</code> method to define any index you want. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mapping = {
    index( [<span class="integer">1</span>],[person.address.postCode] [<span class="key">unique</span>:<span class="predefined-constant">true</span>] )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example I define an index on an embedded attribtue of the document. In fact what arguments you pass to the <code>index</code> method get passed to the underlying MongoDB <a href="https://api.mongodb.org/java/2.12/com/mongodb/DBCollection.html#createIndex(com.mongodb.DBObject,%20com.mongodb.DBObject)">createIndex</a> method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writeConcern">Customizing the WriteConcern</h3>
<div class="paragraph">
<p>A feature of MongoDB is its ability to customize how important a database write is to the user. The Java client models this as a <a href="https://api.mongodb.org/java/current/com/mongodb/WriteConcern.html">WriteConcern</a> and there are various options that indicate whether the client cares about server or network errors, or whether the data has been successfully written or not.</p>
</div>
<div class="paragraph">
<p>If you wish to customize the <code>WriteConcern</code> for a domain class you can do so in the mapping block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.mongodb.WriteConcern</span>

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> mapping = {
        writeConcern WriteConcern.FSYNC_SAFE
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For versioned entities, if a lower level of WriteConcern than WriteConcern.ACKNOWLEDGE is specified, WriteConcern.ACKNOWLEDGE will also be used for updates, to ensure that optimistic locking failures are reported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dynamicAttributes">Dynamic Attributes</h3>
<div class="paragraph">
<p>Unlike a relational database, MongoDB allows for "schemaless" persistence where there are no limits to the number of attributes a particular document can have. A GORM domain class on the other hand has a schema in that there are a fixed number of properties. For example consider the following domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Plant</span> {
    <span class="type">boolean</span> goesInPatch
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here there are two fixed properties, <code>name</code> and <code>goesInPatch</code>, that will be persisted into the MongoDB document. Using GORM for MongoDB you can however use dynamic properties via the Groovy subscript operator. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Plant(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Pineapple</span><span class="delimiter">&quot;</span></span>)
p[<span class="string"><span class="delimiter">'</span><span class="content">color</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">Yellow</span><span class="delimiter">'</span></span>
p[<span class="string"><span class="delimiter">'</span><span class="content">hasLeaves</span><span class="delimiter">'</span></span>] = <span class="predefined-constant">true</span>
p.save()

p = Plant.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pineapple</span><span class="delimiter">&quot;</span></span>)

println p[<span class="string"><span class="delimiter">'</span><span class="content">color</span><span class="delimiter">'</span></span>]
println p[<span class="string"><span class="delimiter">'</span><span class="content">hasLeaves</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the subscript operator you can add additional attributes to the underlying <code>Document</code> instance that gets persisted to the MongoDB allowing for more dynamic domain models.</p>
</div>
</div>
<div class="sect2">
<h3 id="customTypes">Custom User Types</h3>
<div class="paragraph">
<p>GORM for MongoDB will persist all common known Java types like String, Integer, URL etc., however if you want to persist one of your own classes that is not a domain class you can implement a custom user type.</p>
</div>
<div class="sect3">
<h4 id="_custom_codecs">Custom Codecs</h4>
<div class="paragraph">
<p>GORM for MongoDB is built ontop of MongoDB&#8217;s BSON encoding framework. This means it is possible to implement custom <a href="https://mongodb.github.io/mongo-java-driver/3.2/bson/codecs">Codecs</a> for encoding and decoding values to and from BSON.</p>
</div>
<div class="paragraph">
<p>For example consider the following simple Groovy class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Birthday</span> {
    <span class="predefined-type">Date</span> date
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the encoding engine does not know how to represent this type as a BSON value. To make the encoding engine understand this type you have to implement a custom codec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.bson.*</span>
<span class="keyword">import</span> <span class="include">org.bson.codecs.*</span>

<span class="type">class</span> <span class="class">BirthdayCodec</span> <span class="directive">implements</span> Codec&lt;Birthday&gt; {
    Birthday decode(BsonReader reader, DecoderContext decoderContext) {
        <span class="keyword">return</span> <span class="keyword">new</span> Birthday(<span class="key">date</span>: <span class="keyword">new</span> <span class="predefined-type">Date</span>(reader.readDateTime())) <i class="conum" data-value="1"></i><b>(1)</b>
    }
    <span class="type">void</span> encode(BsonWriter writer, Birthday value, EncoderContext encoderContext) {
        writer.writeDateTime(value.date.time) <i class="conum" data-value="2"></i><b>(2)</b>
    }
    <span class="predefined-type">Class</span>&lt;Birthday&gt; getEncoderClass() { Birthday } <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Decodes the <code>Birthday</code> type from the <code>BsonReader</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Encodes the <code>Birthday</code> type to the <code>BsonWriter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns the type that is to be encoded. In this case <code>Birthday</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With that done you then need to register the custom <code>Codec</code>. There are two ways to achieve this.</p>
</div>
<div class="paragraph">
<p>You can register a list of codecs in the <code>grails.mongodb.codecs</code> setting in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">mongodb</span>:
        <span class="key">codecs</span>:
            - <span class="string"><span class="content">my.company.BirthdayCodec</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can create a <code>META-INF/services/org.bson.codecs.Codec</code> file containing the fully qualified class name of the <code>Codec</code>. If there are multiple codec classes you would like to register, put each one on a separate line.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_types_with_gorm">Custom Types with GORM</h4>
<div class="paragraph">
<p>Another option is to define a GORM custom type. For example consider the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Birthday</span> <span class="directive">implements</span> <span class="predefined-type">Comparable</span>{
    <span class="predefined-type">Date</span> date

    Birthday(<span class="predefined-type">Date</span> date) {
        <span class="local-variable">this</span>.date = date
    }

    <span class="annotation">@Override</span>
    <span class="type">int</span> compareTo(<span class="predefined-type">Object</span> t) {
        date.compareTo(t.date)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Custom types should go in src/groovy not grails-app/domain
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you attempt to reference this class from a domain class it will not automatically be persisted for you. However you can create a custom type implementation and register it with Spring. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.transform.InheritConstructors</span>
<span class="keyword">import</span> <span class="include">org.bson.Document</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.engine.types.AbstractMappingAwareCustomTypeMarshaller</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.model.PersistentProperty</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.mongo.query.MongoQuery</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.query.Query</span>

<span class="annotation">@InheritConstructors</span>
<span class="type">class</span> <span class="class">BirthdayType</span> <span class="directive">extends</span> AbstractMappingAwareCustomTypeMarshaller&lt;Birthday, <span class="predefined-type">Document</span>, <span class="predefined-type">Document</span>&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">protected</span> <span class="predefined-type">Object</span> writeInternal(PersistentProperty property, <span class="predefined-type">String</span> key, Birthday value, <span class="predefined-type">Document</span> nativeTarget) {
       <span class="directive">final</span> converted = value.date.time
       nativeTarget.put(key, converted)
       <span class="keyword">return</span> converted
   }

   <span class="annotation">@Override</span>
   <span class="directive">protected</span> <span class="type">void</span> queryInternal(PersistentProperty property, <span class="predefined-type">String</span> key, PropertyCriterion criterion, <span class="predefined-type">Document</span> nativeQuery) {
       <span class="keyword">if</span> (criterion <span class="keyword">instanceof</span> Between) {
           <span class="keyword">def</span> dbo = <span class="keyword">new</span> BasicDBObject()
           dbo.put(MongoQuery.MONGO_GTE_OPERATOR, criterion.getFrom().date.time)
           dbo.put(MongoQuery.MONGO_LTE_OPERATOR, criterion.getTo().date.time)
           nativeQuery.put(key, dbo)
       }
       <span class="keyword">else</span> {
           nativeQuery.put(key, criterion.value.date.time)
       }
   }

   <span class="annotation">@Override</span>
   <span class="directive">protected</span> Birthday readInternal(PersistentProperty property, <span class="predefined-type">String</span> key, <span class="predefined-type">Document</span> nativeSource) {
       <span class="directive">final</span> num = nativeSource.get(key)
       <span class="keyword">if</span> (num <span class="keyword">instanceof</span> <span class="predefined-type">Long</span>) {
           <span class="keyword">return</span> <span class="keyword">new</span> Birthday(<span class="keyword">new</span> <span class="predefined-type">Date</span>(num))
       }
       <span class="keyword">return</span> <span class="predefined-constant">null</span>
   }
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>BirthdayType</code> class is a custom user type implementation for MongoDB for the <code>Birthday</code> class. It provides implementations for three methods: <code>readInternal</code>, <code>writeInternal</code> and the optional <code>queryInternal</code>. If you do not implement <code>queryInternal</code> your custom type can be persisted but not queried.</p>
</div>
<div class="paragraph">
<p>The <code>writeInternal</code> method gets passed the property, the key to store it under, the value and the native DBObject where the custom type is to be stored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="predefined-type">Object</span> writeInternal(PersistentProperty property, <span class="predefined-type">String</span> key, Birthday value, DBObject nativeTarget) {
    <span class="directive">final</span> converted = value.date.time
    nativeTarget.put(key, converted)
    <span class="keyword">return</span> converted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then read the values of the custom type and register them with the <code>DBObject</code>. The <code>readInternal</code> method gets passed the <code>PersistentProperty</code>, the key the user type info is stored under (although you may want to use multiple keys) and the <code>DBObject</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="directive">protected</span> Birthday readInternal(PersistentProperty property, <span class="predefined-type">String</span> key, <span class="predefined-type">Document</span> nativeSource) {
    <span class="directive">final</span> num = nativeSource.get(key)
    <span class="keyword">if</span>(num <span class="keyword">instanceof</span> <span class="predefined-type">Long</span>) {
        <span class="keyword">return</span> <span class="keyword">new</span> Birthday(<span class="keyword">new</span> <span class="predefined-type">Date</span>(num))
    }
    <span class="keyword">return</span> <span class="predefined-constant">null</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then construct the custom type by reading values from the <code>DBObject</code>. Finally the <code>queryInternal</code> method allows you to handle how a custom type is queried:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> queryInternal(PersistentProperty property, <span class="predefined-type">String</span> key, <span class="predefined-type">Query</span>.PropertyCriterion criterion, <span class="predefined-type">Document</span> nativeQuery) {
    <span class="keyword">if</span>(criterion <span class="keyword">instanceof</span> Between) {
        <span class="keyword">def</span> dbo = <span class="keyword">new</span> BasicDBObject()
        dbo.put(MongoQuery.MONGO_GTE_OPERATOR, criterion.getFrom().date.time);
        dbo.put(MongoQuery.MONGO_LTE_OPERATOR, criterion.getTo().date.time);
        nativeQuery.put(key, dbo)
    }
    <span class="keyword">else</span> <span class="keyword">if</span>(criterion <span class="keyword">instanceof</span> Equals){
        nativeQuery.put(key, criterion.value.date.time)
    }
    <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">unsupported query type for property </span><span class="inline"><span class="inline-delimiter">$</span>property</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method gets passed a <code>criterion</code> which is the type of query and depending on the type of query you may handle the query differently. For example the above implementation supports <code>between</code> and <code>equals</code> style queries. So the following 2 queries will work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person.findByBirthday(<span class="keyword">new</span> Birthday(<span class="keyword">new</span> <span class="predefined-type">Date</span>()-<span class="integer">7</span>)) <span class="comment">// find someone who was born 7 days ago</span>
Person.findByBirthdayBetween(<span class="keyword">new</span> Birthday(<span class="keyword">new</span> <span class="predefined-type">Date</span>()-<span class="integer">7</span>), <span class="keyword">new</span> Birthday(<span class="keyword">new</span> <span class="predefined-type">Date</span>())) <span class="comment">// find someone who was born in the last 7 days</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However "like" or other query types will not work.</p>
</div>
<div class="paragraph">
<p>To register a custom type in a grails application simply register it as Spring bean. For example, to register the above <code>BirthdayType</code> add the following to grails-app/conf/spring/resources.groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.example.*</span>

<span class="comment">// Place your Spring DSL code here</span>
beans = {
  birthdayType(BirthdayType, Birthday)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="querying">Querying</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="queryingBasicsl">Basic Querying</h3>
<div class="paragraph">
<p>GORM for MongoDB supports all of the <a href="https://gorm.grails.org/latest/hibernate/manual/index.html#querying">regular methods</a> for executing GORM queries apart from HQL, which is a Hibernate specific query language more appropriate for SQL databases.</p>
</div>
<div class="paragraph">
<p>If you wish to execute a native MongoDB query you can use the <code>find</code> method that takes a <a href="https://api.mongodb.com/java/current/org/bson/conversions/Bson.html">Bson</a> argument. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.mongodb.client.FindIterable</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.mongodb.client.model.Filters.*</span>
...
FindIterable findIterable = Product.find(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">coffee</span><span class="delimiter">&quot;</span></span>))
findIterable.limit(<span class="integer">10</span>)
            .each { Product product -&gt;
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">Product title </span><span class="inline"><span class="inline-delimiter">$</span>product</span><span class="content">.title</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>find</code> method will return a <a href="https://api.mongodb.com/java/current/com/mongodb/client/FindIterable.html">FindIterable</a> instance that you can then use to further customize via <a href="https://api.mongodb.com/java/current/com/mongodb/client/model/Filters.html">filters</a>, <a href="https://api.mongodb.com/java/current/com/mongodb/client/model/Sorts.html">sorting</a> and <a href="https://api.mongodb.com/java/current/com/mongodb/client/model/Projections.html">projections</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For the full MongoDB client model refer to the <a href="https://api.mongodb.com/java/current/com/mongodb/client/model/package-summary.html">com.mongodb.client.model</a> package.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>find</code> method will return instances of your domain class for each query. If you wish to instead obtain MongoDB <a href="https://api.mongodb.com/java/current/org/bson/Document.html">Document</a> instance then you should use the <code>collection</code> property of the domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.mongodb.client.FindIterable</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.mongodb.client.model.Filters.*</span>
...
Document doc = Product.collection
                        .find(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">coffee</span><span class="delimiter">&quot;</span></span>))
                        .first()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="geoSpatial">Geospacial Querying</h3>
<div class="paragraph">
<p>MongoDB supports storing <a href="https://docs.mongodb.org/manual/applications/geospatial-indexes/">Geospacial data</a> in both flat and spherical surface types.</p>
</div>
<div class="paragraph">
<p>To store data in a flat surface you use a "2d" index, whilst a "2dsphere" index used for spherical data. GORM for MongoDB supports both and the following sections describe how to define and query Geospacial data.</p>
</div>
<div class="sect3">
<h4 id="twodsphere">Geospacial 2D Sphere Support</h4>

</div>
<div class="sect3">
<h4 id="_using_a_2dsphere_index">Using a 2dsphere Index</h4>
<div class="paragraph">
<p>MongoDB&#8217;s <a href="https://docs.mongodb.org/manual/core/2dsphere/">2dsphere indexes</a> support queries that calculate geometries on an earth-like sphere.</p>
</div>
<div class="paragraph">
<p>Although you can use coordinate pairs in a 2dsphere index, they are considered legacy by the MongoDB documentation and it is recommended you store data using <a href="https://geojson.org/geojson-spec.html#id2">GeoJSON Point</a> types.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
MongoDB legacy coordinate pairs are in latitude / longitude order, whilst GeoJSON points are stored in longitude / latitude order!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To support this GORM for MongoDB features a special type, <code>grails.mongodb.geo.Point</code>, that can be used within domain classes to store geospacial data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.mongodb.geo.*</span>
...
class Restaurant {
    ObjectId id
    <span class="predefined-type">Point</span> location

    <span class="directive">static</span> mapping = {
        location <span class="key">geoIndex</span>:<span class="string"><span class="delimiter">'</span><span class="content">2dsphere</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Point</code> type gets persisted as a <a href="https://geojson.org/geojson-spec.html#id2">GeoJSON Point</a>. A <code>Point</code> can be constructed from coordinates represented in longitude and latitude (the inverse of 2d index location coordinates!). Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Restaurant r = <span class="keyword">new</span> Restaurant(<span class="key">location</span>: <span class="keyword">new</span> <span class="predefined-type">Point</span>(<span class="integer">50</span>, <span class="integer">50</span>))
r.id = <span class="string"><span class="delimiter">&quot;</span><span class="content">Dan's Burgers</span><span class="delimiter">&quot;</span></span>
r.save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)

Restaurant.findByLocation(<span class="keyword">new</span> <span class="predefined-type">Point</span>(<span class="integer">50</span>,<span class="integer">50</span>))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_querying_a_2dsphere_index">Querying a 2dsphere Index</h4>
<div class="paragraph">
<p>Once the 2dsphere index is in place you can use various MongoDB plugin specific dynamic finders to query, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>findBy&#8230;&#8203;GeoWithin</strong> - Find out whether a <code>Point</code> is within a <code>Box</code>, <code>Polygon</code>, <code>Circle</code> or <code>Sphere</code></p>
</li>
<li>
<p><strong>findBy&#8230;&#8203;GeoIntersects</strong> - Find out whether a <code>Point</code> is within a <code>Box</code>, <code>Polygon</code>, <code>Circle</code> or <code>Sphere</code></p>
</li>
<li>
<p><strong>findBy&#8230;&#8203;Near</strong> - Find out whether any GeoJSON <code>Shape</code> is near the given <code>Point</code></p>
</li>
<li>
<p><strong>findBy&#8230;&#8203;NearSphere</strong> - Find out whether any GeoJSON <code>Shape</code> is near the given <code>Point</code> using spherical geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Restaurant.findByLocationGeoWithin( <span class="predefined-type">Polygon</span>.valueOf([ [<span class="integer">0</span>, <span class="integer">0</span>], [<span class="integer">100</span>, <span class="integer">0</span>], [<span class="integer">100</span>, <span class="integer">100</span>], [<span class="integer">0</span>, <span class="integer">100</span>], [<span class="integer">0</span>, <span class="integer">0</span>] ]) )
Restaurant.findByLocationGeoWithin( <span class="predefined-type">Box</span>.valueOf( [[<span class="integer">25</span>, <span class="integer">25</span>], [<span class="integer">100</span>, <span class="integer">100</span>]] ) )
Restaurant.findByLocationGeoWithin( Circle.valueOf( [[<span class="integer">50</span>, <span class="integer">50</span>], <span class="integer">100</span>] ) )
Restaurant.findByLocationGeoWithin( Sphere.valueOf( [[<span class="integer">50</span>, <span class="integer">50</span>], <span class="float">0.06</span>]) )
Restaurant.findByLocationNear( <span class="predefined-type">Point</span>.valueOf( <span class="integer">40</span>, <span class="integer">40</span> ) )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that a <code>Sphere</code> differs from a <code>Circle</code> in that the radius is specified in <a href="https://docs.mongodb.org/manual/tutorial/calculate-distances-using-spherical-geometry-with-2d-geospatial-indexes/">radians</a>.
There is a special <code>Distance</code> class that can help with radian calculation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_native_querying_support">Native Querying Support</h4>
<div class="paragraph">
<p>In addition to being able to pass any <code>Shape</code> to geospacial query methods you can also pass a map that represents the native values to be passe to the underlying query. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Restaurant.findAllByLocationNear( [<span class="error">$</span><span class="key">geometry</span>: [<span class="key">type</span>:<span class="string"><span class="delimiter">'</span><span class="content">Point</span><span class="delimiter">'</span></span>, <span class="key">coordinates</span>: [<span class="integer">1</span>,<span class="integer">7</span>]], <span class="error">$</span><span class="key">maxDistance</span>:<span class="integer">30000</span>] )</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the native query parameters are simply passed to the <a href="https://docs.mongodb.org/manual/reference/operator/query/near/#op._S_near">$near query</a></p>
</div>
</div>
<div class="sect3">
<h4 id="twodindex">Geospacial 2D Index Support</h4>
<div class="paragraph">
<p>MongoDB supports <a href="https://docs.mongodb.org/manual/core/2d/">2d indexes</a> that store points on a two-dimensional plane. although they are considered legacy and you should use <code>2dsphere</code> indexes instead.</p>
</div>
<div class="paragraph">
<p>It is possible to use a MongoDB 2d index by mapping a list or map property using the <code>geoIndex</code> mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Hotel</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">List</span> location

    <span class="directive">static</span> mapping = {
        location <span class="key">geoIndex</span>:<span class="string"><span class="delimiter">'</span><span class="content">2d</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the index creation assumes latitude/longitude and thus is configured for a -180..180 range. If you are indexing something else you can customise this with <code>indexAttributes</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Hotel</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">List</span> location

    <span class="directive">static</span> mapping = {
        location <span class="key">geoIndex</span>:<span class="string"><span class="delimiter">'</span><span class="content">2d</span><span class="delimiter">'</span></span>, <span class="key">indexAttributes</span>:[<span class="key">min</span>:-<span class="integer">500</span>, <span class="key">max</span>:<span class="integer">500</span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then save Geo locations using a two dimensional list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> Hotel(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Hilton</span><span class="delimiter">&quot;</span></span>, <span class="key">location</span>:[<span class="integer">50</span>, <span class="integer">50</span>]).save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can use a map with keys representing latitude and longitude:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> Hotel(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Hilton</span><span class="delimiter">&quot;</span></span>, <span class="key">location</span>:[<span class="key">lat</span>: <span class="float">40.739037d</span>, <span class="type">long</span>: <span class="float">73.992964d</span>]).save()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must specify whether the number of a floating point or double by adding a <em>d</em> or <em>f</em> at the end of the number eg. 40.739037d. Groovy&#8217;s default type for decimal numbers is <code>BigDecimal</code> which is not supported by MongoDB.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have your data indexed you can use MongoDB specific dynamic finders to find hotels near a given a location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> h = Hotel.findByLocationNear([<span class="integer">50</span>, <span class="integer">60</span>])
<span class="keyword">assert</span> h.name == <span class="string"><span class="delimiter">'</span><span class="content">Hilton</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also find a location within a box (bound queries). Boxes are defined by specifying the lower-left and upper-right corners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> box = [[<span class="float">40.73083d</span>, -<span class="float">73.99756d</span>], [<span class="float">40.741404d</span>,  -<span class="float">73.988135d</span>]]
<span class="keyword">def</span> h = Hotel.findByLocationWithinBox(box)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also find a location within a circle. Circles are specified using a center and radius:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> center = [<span class="integer">50</span>, <span class="integer">50</span>]
<span class="keyword">def</span> radius = <span class="integer">10</span>
<span class="keyword">def</span> h = Hotel.findByLocationWithinCircle([center, radius])</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you plan on querying a location and some other value it is recommended to use a compound index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Hotel</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">List</span> location
    <span class="type">int</span> stars

    <span class="directive">static</span> mapping = {
        compoundIndex <span class="key">location</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2d</span><span class="delimiter">&quot;</span></span>, <span class="key">stars</span>:<span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above you an index is created for both the location and the number of stars a <code>Hotel</code> has.</p>
</div>
</div>
<div class="sect3">
<h4 id="geoJson">GeoJSON Data Models</h4>
<div class="paragraph">
<p>You can also store any GeoJSON shape using the <code>grails.mongodb.geo.Shape</code> super class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.mongodb.geo.*</span>
...
class Entry {
    ObjectId id
    <span class="predefined-type">Shape</span> shape

    <span class="directive">static</span> mapping = {
        shape <span class="key">geoIndex</span>:<span class="string"><span class="delimiter">'</span><span class="content">2dsphere</span><span class="delimiter">'</span></span>
    }
}
...
new Entry(<span class="key">shape</span>: <span class="predefined-type">Polygon</span>.valueOf([[[<span class="integer">3</span>, <span class="integer">1</span>], [<span class="integer">1</span>, <span class="integer">2</span>], [<span class="integer">5</span>, <span class="integer">6</span>], [<span class="integer">9</span>, <span class="integer">2</span>], [<span class="integer">4</span>, <span class="integer">3</span>], [<span class="integer">3</span>, <span class="integer">1</span>]]]) ).save()
<span class="keyword">new</span> Entry(<span class="key">shape</span>: LineString.valueOf([[<span class="integer">5</span>, <span class="integer">2</span>], [<span class="integer">7</span>, <span class="integer">3</span>], [<span class="integer">7</span>, <span class="integer">5</span>], [<span class="integer">9</span>, <span class="integer">4</span>]]) ).save()
<span class="keyword">new</span> Entry(<span class="key">shape</span>: <span class="predefined-type">Point</span>.valueOf([<span class="integer">5</span>, <span class="integer">2</span>])).save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then use the <code>findBy*GeoIntersects</code> method to figure out whether shapes intersect with each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Entry.findByShapeGeoIntersects( <span class="predefined-type">Polygon</span>.valueOf( [[ [<span class="integer">0</span>,<span class="integer">0</span>], [<span class="integer">3</span>,<span class="integer">0</span>], [<span class="integer">3</span>,<span class="integer">3</span>], [<span class="integer">0</span>,<span class="integer">3</span>], [<span class="integer">0</span>,<span class="integer">0</span>] ]] ) )
<span class="keyword">assert</span> Entry.findByShapeGeoIntersects( LineString.valueOf( [[<span class="integer">1</span>,<span class="integer">4</span>], [<span class="integer">8</span>,<span class="integer">4</span>]] ) )</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="textSearch">Full Text Search</h3>
<div class="paragraph">
<p>Using MongoDB 2.6 and above you can create <a href="https://docs.mongodb.org/manual/reference/operator/query/text/#op._S_text">full text search</a> indices.</p>
</div>
<div class="paragraph">
<p>To create a "text" index using the <code>index</code> method inside the <code>mapping</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Product</span> {
    ObjectId id
    <span class="predefined-type">String</span> title

    <span class="directive">static</span> mapping = {
        index <span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then search for instances using the <code>search</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Product.search(<span class="string"><span class="delimiter">&quot;</span><span class="content">bake coffee cake</span><span class="delimiter">&quot;</span></span>).size() == <span class="integer">10</span>
<span class="keyword">assert</span> Product.search(<span class="string"><span class="delimiter">&quot;</span><span class="content">bake coffee -cake</span><span class="delimiter">&quot;</span></span>).size() == <span class="integer">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can search for the top results by rank using the <code>searchTop</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Product.searchTop(<span class="string"><span class="delimiter">&quot;</span><span class="content">cake</span><span class="delimiter">&quot;</span></span>).size() == <span class="integer">4</span>
<span class="keyword">assert</span> Product.searchTop(<span class="string"><span class="delimiter">&quot;</span><span class="content">cake</span><span class="delimiter">&quot;</span></span>,<span class="integer">3</span>).size() == <span class="integer">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And count the number of hits with the <code>countHits</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Product.countHits(<span class="string"><span class="delimiter">'</span><span class="content">coffee</span><span class="delimiter">'</span></span>) == <span class="integer">5</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multipleDataSources">Multiple Data Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for MongoDB supports the notion of multiple data sources where multiple individual <code>MongoClient</code> instances can be configured and switched between.</p>
</div>
<div class="sect2">
<h3 id="_configuring_multiple_mongo_clients">Configuring Multiple Mongo Clients</h3>
<div class="paragraph">
<p>To configure multiple Mongo client connections you need to use the <code>grails.mongodb.connections</code> setting. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">mongodb</span>:
        <span class="key">url</span>: <span class="string"><span class="content">mongodb://localhost/books</span></span>
        <span class="key">connections</span>:
            <span class="key">moreBooks</span>:
                <span class="key">url</span>: <span class="string"><span class="content">mongodb://localhost/moreBooks</span></span>
            <span class="key">evenMoreBooks</span>:
                <span class="key">url</span>: <span class="string"><span class="content">mongodb://localhost/moreBooks</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure individual settings for each Mongo client. If a setting is not specified by default the setting is inherited from the default Mongo client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_domain_classes_to_mongo_clients">Mapping Domain Classes to Mongo Clients</h3>
<div class="paragraph">
<p>If a domain class has no specify Mongo client connection configuration then the default is used.</p>
</div>
<div class="paragraph">
<p>You can set the <code>connection</code> method in the <code>mapping</code> block to configure an alternate Mongo Client.</p>
</div>
<div class="paragraph">
<p>For example, if you want to use the <code>ZipCode</code> domain to use a Mongo client connection called <code>'lookup'</code>, configure it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connection <span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A domain class can also use two or more configured Mongo client connections by using the <code>connections</code> method with a list of names to configure more than one, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connections([<span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">auditing</span><span class="delimiter">'</span></span>])
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a domain class uses the default connection and one or more others, you can use the <code>ConnectionSource.DEFAULT</code> constant to indicate that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.core.connections.*</span>

<span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connections([<span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>, ConnectionSource.DEFAULT])
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a domain class uses all configured <code>DataSource</code> instances use the value <code>ALL</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.core.connections.*</span>

<span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      connection ConnectionSource.ALL
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_switching_between_mongo_clients">Switching between Mongo Clients</h3>
<div class="paragraph">
<p>You can switch to a different connection at runtime with the <code>withConnection</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.withConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">moreBooks</span><span class="delimiter">&quot;</span></span>) {
    <span class="predefined-type">Book</span>.list()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any logic executed within the body of the closure will use the alternate connection. Once the close finishes execution GORM will switch back to the default connection automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="connectionSources">The ConnectionSources API</h3>
<div class="paragraph">
<p>Introduced in GORM 6.0, the <a href="../api/org/grails/datastore/mapping/core/connections/ConnectionSources.html">ConnectionSources</a> API allows you to introspect the data sources configured for the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span>
MongoDatastore mongoDatastore
...
ConnectionSources&lt;MongoClient, MongoConnectionSourceSettings&gt; connectionSources
                                        = mongoDatastore.getConnectionSources()

<span class="keyword">for</span>(ConnectionSource&lt;MongoClient, MongoConnectionSourceSettings&gt; connectionSource <span class="keyword">in</span> connectionSources) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Name </span><span class="inline"><span class="inline-delimiter">$</span>connectionSource</span><span class="content">.name</span><span class="delimiter">&quot;</span></span>
        MongoClient mongoClient = connectionSource.source
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="databaseSwitching">Switching Database or Collection at Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to storing dynamic attributes, as of version 1.3.0 of the plugin you can also switch which database and/or collection to persist to at runtime.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person.withDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">administrators</span><span class="delimiter">&quot;</span></span>) {
    <span class="keyword">new</span> Person(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>).save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will save a <code>Person</code> instance to the <em>administrators</em> database. The database is used for the scope of the closure. You can switch database for the scope of the active session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person.useDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">administrators</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">new</span> Person(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>).save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, there are equivalent <code>withCollection</code> and <code>useCollection</code> methods for switching collection at runtime.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multiTenancy">Multi-Tenancy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for MongoDb supports the following multi-tenancy modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DATABASE</code> - A separate database with a separate connection pool is used to store each tenants data.</p>
</li>
<li>
<p><code>SCHEMA</code> - The same database, but different schemas are used to store each tenants data.</p>
</li>
<li>
<p><code>DISCRIMINATOR</code> - The same database is used with a discriminator used to partition and isolate data.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuring_multi_tenancy">Configuring Multi Tenancy</h3>
<div class="paragraph">
<p>You can configure Multi-Tenancy the same way described in the <a href="../../hibernate/manual/index.html#multiTenancy">GORM for Hibernate documenation</a>, simply specify a multi tenancy mode and resolver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">gorm</span>:
        <span class="key">multiTenancy</span>:
            <span class="key">mode</span>: <span class="string"><span class="content">DATABASE</span></span>
            <span class="key">tenantResolverClass</span>: <span class="string"><span class="content">org.grails.datastore.mapping.multitenancy.web.SubDomainTenantResolver</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you are using MongoDB and Hibernate together the above configuration will configure both MongoDB <strong>and</strong> Hibernate to use a multi-tenancy mode of <code>DATABASE</code>.</p>
</div>
<div class="paragraph">
<p>If you only want to enable multi-tenancy for MongoDB only you can use the following configuration instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">mongodb</span>:
        <span class="key">multiTenancy</span>:
            <span class="key">mode</span>: <span class="string"><span class="content">DATABASE</span></span>
            <span class="key">tenantResolverClass</span>: <span class="string"><span class="content">org.grails.datastore.mapping.multitenancy.web.SubDomainTenantResolver</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multi_tenancy_transformations">Multi-Tenancy Transformations</h3>
<div class="paragraph">
<p>The following transformations can be applied to any class to simplify greatly the development of Multi-Tenant applications. These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@CurrentTenant</code> - Resolve the current tenant for the context of a class or method</p>
</li>
<li>
<p><code>@Tenant</code> - Use a specific tenant for the context of a class or method</p>
</li>
<li>
<p><code>@WithoutTenant</code> - Execute logic without a specific tenant (using the default connection)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.multitenancy.*</span>

<span class="comment">// resolve the current tenant for every method</span>
<span class="annotation">@CurrentTenant</span>
<span class="type">class</span> <span class="class">TeamService</span> {

    <span class="comment">// execute the countPlayers method without a tenant id</span>
    <span class="annotation">@WithoutTenant</span>
    <span class="type">int</span> countPlayers() {
        Player.count()
    }

    <span class="comment">// use the tenant id &quot;another&quot; for all GORM logic within the method</span>
    <span class="annotation">@Tenant</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">another</span><span class="delimiter">&quot;</span></span>})
    <span class="predefined-type">List</span>&lt;Team&gt; allTwoTeams() {
        Team.list()
    }

    <span class="predefined-type">List</span>&lt;Team&gt; listTeams() {
        Team.list(<span class="key">max</span>:<span class="integer">10</span>)
    }

    <span class="annotation">@Transactional</span>
    <span class="type">void</span> addTeam(<span class="predefined-type">String</span> name) {
        <span class="keyword">new</span> Team(<span class="key">name</span>:name).save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multi_tenancy_modes">Multi Tenancy Modes</h3>
<div class="paragraph">
<p>As mentioned previously, GORM for MongoDB supports all three multi tenancy modes however there are some considerations to keep in mind.</p>
</div>
<div class="sect3">
<h4 id="_database_per_tenant">Database Per Tenant</h4>
<div class="paragraph">
<p>When using the <code>DATABASE</code> mode, only GORM methods calls are dispatched to the correct tenant. This means the following will use the tenant id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// switches to the correct client based on the tenant id</span>
<span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, going directly through the <code>MongoClient</code> will not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span> MongoClient mongoClient

<span class="comment">// uses the default connection and doesn't resolve the tenant it</span>
mongoClient.getDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>).find()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are working directly with the <code>MongoClient</code> instance you need to make sure you obtain the correct instance. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.multitenancy.*</span>

<span class="annotation">@Autowired</span> MongoDatastore mongoDatastore
...
MongoClient mongoClient =
        mongoDatastore.getDatastoreForTenantId(Tenants.currentId())
                      .getMongoClient()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_schema_per_tenant">Schema Per Tenant</h4>
<div class="paragraph">
<p>When using the <code>SCHEMA</code> mode, GORM for MongoDB will use a different MongoDB database, but the same <code>MongoClient</code> instance, for each tenant.</p>
</div>
<div class="paragraph">
<p>However, once again only GORM methods will use the correct database. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// switches to the correct database based on the tenant id</span>
<span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, getting the database directly from <code>MongoClient</code> will not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span> MongoClient mongoClient

<span class="comment">// uses the default connection and doesn't resolve the tenant it</span>
mongoClient.getDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>).find()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To resolve this you should always use the <code>DB</code> property of the class which will ensure the right database is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// switches to the correct database based on the tenant id</span>
<span class="predefined-type">Book</span>.DB.find()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_partitioned_multi_tenancy">Partitioned Multi-Tenancy</h4>
<div class="paragraph">
<p>When using the <code>DISCRIMINATOR</code> approach, GORM for MongoDB will store a <code>tenantId</code> attribute in each MongoDB document and attempt to partition the data.</p>
</div>
<div class="paragraph">
<p>Once again this works only when using GORM methods and even then there are cases where it will not work if you use native MongoDB interfaces.</p>
</div>
<div class="paragraph">
<p>For example the following works fine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// correctly includes the `tenantId` in the query</span>
<span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>As does this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">com.mongodb.client.model.Filters.*</span>;

<span class="comment">// correctly includes the `tenantId` in the query</span>
<span class="predefined-type">Book</span>.find(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>)).first()</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this logic bypasses any built into tenant id interception and inclusion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.collection.find().first()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since you are operating directly on the collection GORM cannot know when you perform a query on said collection.</p>
</div>
<div class="paragraph">
<p>In this case you will have to ensure to include the <code>tenantId</code> manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">com.mongodb.client.model.Filters.*</span>;
...
Book.collection.find(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">tenantId</span><span class="delimiter">&quot;</span></span>, Tenants.currentId())).first()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the same is true of write operations such as inserts that are done with the native API.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_connectionsources">Dynamic ConnectionSources</h3>
<div class="paragraph">
<p>If you are using a multi-tenancy mode of <code>DATABASE</code> then by default the expectation is that all tenants are configured in your <code>application.yml</code> file.</p>
</div>
<div class="paragraph">
<p>However, it is possible read your Mongo client connection sources dynamically using <a href="../api/org/grails/datastore/mapping/mongo/connections/MongoConnectionSources.html">MongoConnectionSources</a>.</p>
</div>
<div class="paragraph">
<p>The <code>MongoConnectionSources</code> class will read the mongo client configurations from a Mongo collection called <code>mongo.connections</code> by default. To configure it you must specify the <code>connectionSourcesClass</code> in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">mongodb</span>:
        <span class="key">multiTenancy</span>:
            <span class="key">mode</span>: <span class="string"><span class="content">DATABASE</span></span>
        <span class="key">connectionSourcesClass</span>: <span class="string"><span class="content">org.grails.datastore.mapping.mongo.connections.MongoConnectionSources</span></span>
        <span class="key">connectionsCollection</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myconnections</span><span class="delimiter">&quot;</span></span>
<span class="head"><span class="head">...</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then even add new connections at runtime using the <code>ConnectionSources</code> API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.multitenancy.*</span>

<span class="annotation">@Autowired</span> MongoDatastore mongoDatastore
...
def configuration = [<span class="key">url</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">mongodb://localhost/moreBooks</span><span class="delimiter">&quot;</span></span>]
MongoClient mongoClient =
        mongoDatastore.connectionSources
                                          .addConnectionSource(<span class="string"><span class="delimiter">&quot;</span><span class="content">moreBooks</span><span class="delimiter">&quot;</span></span>, configuration)</code></pre>
</div>
</div>
<div class="paragraph">
<p>All new connection sources will be stored within the specified <code>connectionsCollection</code> and if the application is restarted will read from the <code>connectionsCollection</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
GORM for MongoDB does not implement provisioning of new MongoDB instances at runtime. This is something that would need to be implemented by a cloud services provider for example.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stateless">Stateless Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GORM for MongoDB supports both stateless and stateful modes for mapping domain classes to MongoDB. In general stateful mapping is superior for write heavy applications and stateless mode better for read heavy applications (particularily when large amounts of data is involved).</p>
</div>
<div class="sect3">
<h4 id="_stateful_mode">Stateful mode</h4>
<div class="paragraph">
<p>Domain classes are by default stateful, which means when they are read from a MongoDB document their state is stored in the user session (which is typically bound to the request in Grails). This has several advantages for write heavy applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GORM can automatically detect whether a call to save() is a an update or an insert and act appropriately</p>
</li>
<li>
<p>GORM stores the state of the read MongoDB document and therefore updates to schemaless properties don&#8217;t require an extra query</p>
</li>
<li>
<p>GORM can store the current version and therefore implement optimistic locking</p>
</li>
<li>
<p>Repeated reads of the same entity can be retrieved from the cache, thus optimizing reads as well</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For an example of when a stateful domain class is better consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="predefined-type">Book</span>.get(<span class="integer">1</span>)
b[<span class="string"><span class="delimiter">'</span><span class="content">pages</span><span class="delimiter">'</span></span>] = <span class="integer">400</span>
b[<span class="string"><span class="delimiter">'</span><span class="content">publisher</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">Manning</span><span class="delimiter">'</span></span>
b[<span class="string"><span class="delimiter">'</span><span class="content">rating</span><span class="delimiter">'</span></span>] = <span class="integer">5</span>
b.save(<span class="key">flush</span>:<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>With a stateful entity the updates to the three properties can be batched up and executed in the save() call, when there is no state then 3 updates needs to be executed for each schemaless property (ouch!).</p>
</div>
</div>
<div class="sect3">
<h4 id="_stateless_domain_classes">Stateless Domain classes</h4>
<div class="paragraph">
<p>However, stateful domain classes can cause problems for read-heavy applications. Take for example the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list() <span class="comment">// read 100,000 books</span>
<span class="keyword">for</span>(b <span class="keyword">in</span> books) {
    println b.title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will read 100,000 books and print the title of each. In stateful mode this will almost certainly run out of memory as each MongoDB document is stored in user memory as is each book. Rewriting the code as follows will solve the problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.withStatelessSession {
    <span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list() <span class="comment">// read 100,000 books</span>
    <span class="keyword">for</span>(b <span class="keyword">in</span> books) {
        println b.title
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can map the domain class as stateless, in which case its state will never be stored in the session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    ...
    static mapping = {
        stateless <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_disadvantages_of_stateless_mode">Disadvantages of Stateless Mode</h4>
<div class="paragraph">
<p>There are several disadvantages to using stateless domain classes as the default. One disadvantage is that if you are using assigned identifiers GORM cannot detect whether you want to do an insert or an update so you have to be explicit about which one you want:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>()
b.id = <span class="string"><span class="delimiter">&quot;</span><span class="content">The Book</span><span class="delimiter">&quot;</span></span>
b.insert()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case we use the explicit <em>insert</em> method to tell Grails this is an insert not an udpate. Another disadvantage is that reading of schemaless/dynamic properties is more costly. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list() <span class="comment">// read 100,000 books</span>
<span class="keyword">for</span>(b <span class="keyword">in</span> books) {
    println b[<span class="string"><span class="delimiter">'</span><span class="content">pages</span><span class="delimiter">'</span></span>]
    println b[<span class="string"><span class="delimiter">'</span><span class="content">rating</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here GORM has to execute an additional read method for each schemaless property! This is better written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list() <span class="comment">// read 100,000 books</span>
<span class="keyword">for</span>(b <span class="keyword">in</span> books) {
    <span class="keyword">def</span> dbo = b.dbo
    println dbo[<span class="string"><span class="delimiter">'</span><span class="content">pages</span><span class="delimiter">'</span></span>]
    println dbo[<span class="string"><span class="delimiter">'</span><span class="content">rating</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus only requiring one query. Or alternatively you can use the native API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.collection.find() <span class="comment">// read 100,000 books</span>
<span class="keyword">for</span>(dbo <span class="keyword">in</span> books) {
    <span class="predefined-type">Book</span> b = dbo <span class="keyword">as</span> <span class="predefined-type">Book</span>
    println dbo[<span class="string"><span class="delimiter">'</span><span class="content">pages</span><span class="delimiter">'</span></span>]
    println dbo[<span class="string"><span class="delimiter">'</span><span class="content">rating</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which would be more efficient.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lowLevelApi">Using the MongoDB Driver Directly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A lower level API is provided by the plugin via the MongoDB driver</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is an excellent tutorial on how to use the MongoDB Java driver&#8217;s API directly in the <a href="https://mongodb.github.io/mongo-java-driver/3.1/driver/getting-started/quick-tour/">MongoDB documentation</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example can be seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Get a db reference in the old fashion way</span>
<span class="keyword">def</span> db = mongo.getDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">mydb</span><span class="delimiter">&quot;</span></span>)

<span class="comment">// Insert a document</span>
db.languages.insert([<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Groovy</span><span class="delimiter">'</span></span>])
<span class="comment">// A less verbose way to do it</span>
db.languages.insert(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Ruby</span><span class="delimiter">'</span></span>)
<span class="comment">// Yet another way</span>
db.languages &lt;&lt; [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Python</span><span class="delimiter">'</span></span>]

<span class="comment">// Insert a list of documents</span>
db.languages &lt;&lt; [[<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Javascript</span><span class="delimiter">'</span></span>, <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">prototyped</span><span class="delimiter">'</span></span>], [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Ioke</span><span class="delimiter">'</span></span>, <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">prototyped</span><span class="delimiter">'</span></span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get hold of the <code>mongo</code> instance (which is an instance of the <a href="https://api.mongodb.org/java/current/com/mongodb/Mongo.html">com.mongodb.Mongo</a> class) inside a controller or service simple define a <code>mongo</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> mongo
<span class="keyword">def</span> myAction = {
    <span class="keyword">def</span> db = mongo.getDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">mongo</span><span class="delimiter">&quot;</span></span>)
    db.languages.insert([<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Groovy</span><span class="delimiter">'</span></span>])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A request scoped bean is also available for the default database (typically the name of your application, unless specified by the <code>databaseName</code> config option, plus the suffix "DB").</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> peopleDB
<span class="keyword">def</span> myAction = {
    peopleDB.languages.insert([<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each domain class you define also has a <code>collection</code> property that allows easy access to the underlying <code>Collection</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person.collection.count() == <span class="integer">1</span>
Person.collection.findOne(<span class="key">firstName</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>).lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Flintstone</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can easily convert from a native MongoDB <code>Document</code> into an entity using a cast:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> fred = Person.collection.findOne(<span class="key">firstName</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>) <span class="keyword">as</span> Person</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions">Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MongoDB doesn&#8217;t support transactions directly, however GORM for MongoDB does batch up inserts and updates until the session is flushed. This makes it possible to support some rollback options.</p>
</div>
<div class="paragraph">
<p>You can use either transactional services or the static <code>withTransaction</code> method. To mark a service as using the MongoDB transaction manager, use the static <code>transactional</code> property with the value <code>'mongo'</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> transactional = <span class="string"><span class="delimiter">'</span><span class="content">mongo</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternately you can do ad-hoc transactions using the <code>withTransaction</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person.withTransaction { status -&gt;
    <span class="keyword">new</span> Person(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, <span class="key">age</span>:<span class="integer">50</span>).save()
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">bad</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">new</span> Person(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>, <span class="key">age</span>:<span class="integer">45</span>).save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example in this case neither <code>Person</code> object will be persisted to the database, because underneath the surface a persistence session is being used to batch up both insert operations into a single insert. When an exception is thrown neither insert is ever executed, hence we allow for some transactional semantics at the GORM-level.</p>
</div>
<div class="paragraph">
<p>Using the lower level API you can of course also take advantage of Mongo&#8217;s support for <a href="https://docs.mongodb.org/manual/tutorial/isolate-sequence-of-operations">Atomic operations</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing">Unit Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To write unit tests with MongoDB and Spock you can simply extend from <code>grails.test.mongodb.MongoSpec</code>.</p>
</div>
<div class="paragraph">
<p><code>MongoSpec</code> is an abstract class that will initialise GORM in the setup phase of the specification being executed. It
uses by default a <code>MongoClient</code> instance that connects to a MongoDB instance as defined in your configuration
(by default, <code>localhost</code> and port <code>27017</code>, see <a href="#gettingStarted">Getting Started</a> for more details):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mongodb.MongoSpec</span>
<span class="keyword">import</span> <span class="include">grails.validation.ValidationException</span>
<span class="keyword">import</span> <span class="include">spock.lang.Ignore</span>

<span class="type">class</span> <span class="class">LocalMongoUnitSpec</span> <span class="directive">extends</span> MongoSpec <span class="directive">implements</span> EmbeddedMongoClient {

    <span class="annotation">@Ignore</span>
    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test fail on error</span><span class="delimiter">&quot;</span></span>() {

        <span class="key">when</span>:
        <span class="keyword">def</span> invalid = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
        invalid.save()

        <span class="key">then</span>:
        thrown ValidationException
        invalid.hasErrors()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also provide your own <code>MongoClient</code> instance to use something such as <a href="https://github.com/fakemongo/fongo">Fongo</a>,
as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> functional.tests

<span class="keyword">import</span> <span class="include">grails.test.mongodb.MongoSpec</span>

<span class="type">class</span> <span class="class">BookUnitSpec</span> <span class="directive">extends</span> MongoSpec <span class="directive">implements</span> EmbeddedMongoClient {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Test low-level API extensions</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> db = createMongoClient().getDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="comment">//        db.drop()</span>
        <span class="comment">// Insert a document</span>
        db[<span class="string"><span class="delimiter">'</span><span class="content">languages</span><span class="delimiter">'</span></span>].insert([<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Groovy</span><span class="delimiter">'</span></span>])
        <span class="comment">// A less verbose way to do it</span>
        db.languages.insert(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Ruby</span><span class="delimiter">'</span></span>)
        <span class="comment">// Yet another way</span>
        db.languages &lt;&lt; [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Python</span><span class="delimiter">'</span></span>]

        <span class="key">then</span>:
        db.languages.count() == <span class="integer">3</span>
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Test GORM access</span><span class="delimiter">&quot;</span></span>(){
        <span class="key">when</span>:
        <span class="predefined-type">Book</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">El Quijote</span><span class="delimiter">'</span></span>).save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)

        <span class="key">then</span>:
        <span class="predefined-type">Book</span>.count() ==<span class="integer">1</span>

        <span class="key">when</span>:
        book = <span class="predefined-type">Book</span>.findByTitle(<span class="string"><span class="delimiter">'</span><span class="content">El Quijote</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        book.id
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the default implementation is to scan your classpath searching for domain classes, from the package defined
in the configuration property <code>grails.codegen.defaultPackage</code>, and all the way down its subpackages. If your application
is large, classpath scanning may be slow, so it&#8217;s better to override the method <code>getDomainClasses()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&gt; getDomainClasses() {
    [<span class="predefined-type">Book</span>]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_testing">Integration Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is a plugin available that will execute an in memory Mongo database during your integration tests. Data will be cleared between test cases so they can work similarly to H2 with <code>@Rollback</code>.</p>
</div>
<div class="paragraph">
<p>Visit the github page of the <a href="https://github.com/grails-plugins/grails-embedded-mongodb">Embedded MongoDB Grails Plugin</a> to learn more.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ref-beans">Beans</h3>
<div class="sect3">
<h4 id="ref-beans-mongo">mongo</h4>
<div class="sect4">
<h5 id="_purpose">Purpose</h5>
<div class="paragraph">
<p>Provides access to the native <a href="https://api.mongodb.com/java/current/com/mongodb/async/client/MongoClient.html">MongoClient</a> instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">MongoClient mongo

<span class="type">class</span> <span class="class">FooController</span> {
    MongoClient mongo
    <span class="keyword">def</span> <span class="function">myAction</span>() {
        MongoDatabase db = mongo.getDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">mongo</span><span class="delimiter">&quot;</span></span>)
        db.languages.insert([<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Groovy</span><span class="delimiter">'</span></span>])
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description">Description</h5>
<div class="paragraph">
<p>See the API for the <a href="https://api.mongodb.org/java/current/">Mongo Java Driver</a> for API usage info.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ref-domain-classes">Domain Classes</h3>
<div class="sect3">
<h4 id="ref-domain-classes-collection">collection</h4>
<div class="sect4">
<h5 id="_purpose_2">Purpose</h5>
<div class="paragraph">
<p>Returns the MongoDB <a href="https://api.mongodb.com/java/current/com/mongodb/async/client/MongoCollection.html">collection</a> used for the current domain class</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_2">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">def bookBson = <span class="predefined-type">Book</span>.collection.find().first()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_2">Description</h5>
<div class="paragraph">
<p>The <code>collection</code> property allows access to the underlying MongoDB <a href="https://api.mongodb.com/java/current/com/mongodb/async/client/MongoCollection.html">MongoCollection</a> object, thus allowing direct access to the low-level MongoDB driver.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-collectionName">collectionName</h4>
<div class="sect4">
<h5 id="_purpose_3">Purpose</h5>
<div class="paragraph">
<p>Returns the name of the MongoDB <a href="https://api.mongodb.org/java/current/com/mongodb/DBCollection.html">collection</a> used for the current domain class</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_3">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">println <span class="predefined-type">Book</span>.collectionName</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_3">Description</h5>
<div class="paragraph">
<p>The <code>collectionName</code> property allows introspection of the name of the <a href="https://api.mongodb.org/java/current/com/mongodb/DBCollection.html">DBCollection</a> object used by a given domain class. Can be used in conjunction with <code>useCollection</code> to switch to different collections and back again.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-countHits">countHits</h4>
<div class="sect4">
<h5 id="_purpose_4">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <a href="https://docs.mongodb.org/manual/reference/operator/query/text/#op._S_text">$text</a> search query and returns the number of hits.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_4">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Product.countHits(<span class="string"><span class="delimiter">&quot;</span><span class="content">coffee</span><span class="delimiter">&quot;</span></span>) == <span class="integer">5</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_4">Description</h5>
<div class="paragraph">
<p>The <code>countHits</code> method uses MongoDB&#8217;s full text search support to perform full text search on a "text" index and return the size of the returned cursor.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-DB">DB</h4>

</div>
<div class="sect3">
<h4 id="_purpose_5">Purpose</h4>
<div class="paragraph">
<p>Returns the MongoDB <a href="https://api.mongodb.com/java/current/com/mongodb/async/client/MongoDatabase.html">MongoDatabase</a> object.</p>
</div>
<div class="sect4">
<h5 id="_examples_5">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MongoCollection dbCollection = <span class="predefined-type">Book</span>.DB.getCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_5">Description</h5>
<div class="paragraph">
<p>The <code>DB</code> property allows access to the underlying MongoDB <a href="https://api.mongodb.com/java/current/com/mongodb/async/client/MongoDatabase.html">MongoDatabase</a> object, thus allowing easy access to the low-level MongoDB Java driver.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-dbo">dbo</h4>
<div class="sect4">
<h5 id="_purpose_6">Purpose</h5>
<div class="paragraph">
<p>Returns the MongoDB <a href="https://api.mongodb.com/java/current/org/bson/Document.html">Document</a> for an instance of a domain class</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using the <code>Document</code> object directly is discouraged, because it&#8217;s inefficient. It&#8217;s better to use <a href="#dynamicAttributes">Dynamic Attributes</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_examples_6">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="predefined-type">Book</span>.get(<span class="integer">1</span>)

println b.dbo</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_6">Description</h5>
<div class="paragraph">
<p>The <code>dbo</code> property allows access to the underlying MongoDB <a href="https://api.mongodb.com/java/current/org/bson/Document.html">Document</a>, which is a respresentation of the stored BSON document that can be manipulated in memory.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-findByGeoIntersects">findByGeoIntersects</h4>
<div class="sect4">
<h5 id="_purpose_7">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <a href="https://docs.mongodb.org/manual/reference/operator/query/geoIntersects/">$geoIntersects</a> query</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_7">Examples</h5>
<div class="paragraph">
<p>Given:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.mongodb.geo.*</span>
...
class Entry {
    ObjectId id
    <span class="predefined-type">Shape</span> shape

    <span class="directive">static</span> mapping = {
        shape <span class="key">geoIndex</span>:<span class="string"><span class="delimiter">'</span><span class="content">2dsphere</span><span class="delimiter">'</span></span>
    }
}
...
new Entry(<span class="key">shape</span>: <span class="predefined-type">Polygon</span>.valueOf([[[<span class="integer">3</span>, <span class="integer">1</span>], [<span class="integer">1</span>, <span class="integer">2</span>], [<span class="integer">5</span>, <span class="integer">6</span>], [<span class="integer">9</span>, <span class="integer">2</span>], [<span class="integer">4</span>, <span class="integer">3</span>], [<span class="integer">3</span>, <span class="integer">1</span>]]]) ).save()
<span class="keyword">new</span> Entry(<span class="key">shape</span>: LineString.valueOf([[<span class="integer">5</span>, <span class="integer">2</span>], [<span class="integer">7</span>, <span class="integer">3</span>], [<span class="integer">7</span>, <span class="integer">5</span>], [<span class="integer">9</span>, <span class="integer">4</span>]]) ).save()
<span class="keyword">new</span> Entry(<span class="key">shape</span>: <span class="predefined-type">Point</span>.valueOf([<span class="integer">5</span>, <span class="integer">2</span>])).save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then use the <code>findBy*GeoIntersects</code> method to figure out whether shapes intersect with each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Entry.findByShapeGeoIntersects( <span class="predefined-type">Polygon</span>.valueOf( [[ [<span class="integer">0</span>,<span class="integer">0</span>], [<span class="integer">3</span>,<span class="integer">0</span>], [<span class="integer">3</span>,<span class="integer">3</span>], [<span class="integer">0</span>,<span class="integer">3</span>], [<span class="integer">0</span>,<span class="integer">0</span>] ]] ) )
<span class="keyword">assert</span> Entry.findByShapeGeoIntersects( LineString.valueOf( [[<span class="integer">1</span>,<span class="integer">4</span>], [<span class="integer">8</span>,<span class="integer">4</span>]] ) )
<span class="comment">// native query</span>
<span class="keyword">assert</span> Entry.findByShapeGeoIntersects( [ <span class="error">$</span>geometry : [<span class="key">type</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Polygon</span><span class="delimiter">&quot;</span></span> ,
                                                      <span class="key">coordinates</span>: [ [ [ <span class="integer">0</span> , <span class="integer">0</span> ] , [ <span class="integer">3</span> , <span class="integer">6</span> ] , [ <span class="integer">6</span> , <span class="integer">1</span> ] , [ <span class="integer">0</span> , <span class="integer">0</span> ] ] ]
                                                      ]
                                       ])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_7">Description</h5>
<div class="paragraph">
<p>The $geoIntersects operator is a geospatial query operator that selects all locations that intersect with a GeoJSON object. See <a href="https://docs.mongodb.org/manual/reference/operator/query/geoIntersects/">$geoIntersects</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-findByGeoWithin">findByGeoWithin</h4>
<div class="sect4">
<h5 id="_purpose_8">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <a href="https://docs.mongodb.org/manual/reference/operator/query/geoWithin/">$geoWithin</a> query</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_8">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Restaurant.findByLocationGeoWithin( <span class="predefined-type">Polygon</span>.valueOf([ [<span class="integer">0</span>, <span class="integer">0</span>], [<span class="integer">100</span>, <span class="integer">0</span>], [<span class="integer">100</span>, <span class="integer">100</span>], [<span class="integer">0</span>, <span class="integer">100</span>], [<span class="integer">0</span>, <span class="integer">0</span>] ]) )
Restaurant.findByLocationGeoWithin( <span class="predefined-type">Box</span>.valueOf( [[<span class="integer">25</span>, <span class="integer">25</span>], [<span class="integer">100</span>, <span class="integer">100</span>]] ) )
Restaurant.findByLocationGeoWithin( Circle.valueOf( [[<span class="integer">50</span>, <span class="integer">50</span>], <span class="integer">100</span>] ) )
Restaurant.findByLocationGeoWithin( Sphere.valueOf( [[<span class="integer">50</span>, <span class="integer">50</span>], <span class="float">0.06</span>]) )
<span class="comment">// native query</span>
Restaurant.findByPointGeoWithin([ <span class="string"><span class="delimiter">'</span><span class="content">$polygon</span><span class="delimiter">'</span></span>: [ [<span class="float">0.0d</span>, <span class="float">0.0d</span>], [<span class="float">3.0d</span>, <span class="float">0.0d</span>], [<span class="float">3.0d</span>, <span class="float">3.0d</span>], [<span class="float">0.0d</span>, <span class="float">3.0d</span>], [<span class="float">0.0d</span>, <span class="float">0.0d</span>] ] ])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_8">Description</h5>
<div class="paragraph">
<p>The $geoWithin operator is a geospatial query operator that queries for a defined point, line or shape that exists entirely within another defined shape. When determining inclusion, MongoDB considers the border of a shape to be part of the shape, subject to the precision of floating point numbers.
See <a href="https://docs.mongodb.org/manual/reference/operator/query/geoWithin/">$geoWithin</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-findByNear">findByNear</h4>
<div class="sect4">
<h5 id="_purpose_9">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <a href="https://docs.mongodb.org/manual/reference/operator/query/near/">$near</a> query</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_9">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.mongodb.geo.*</span>
...
Restaurant.findByLocationNear( <span class="predefined-type">Point</span>.valueOf( <span class="integer">40</span>, <span class="integer">40</span> ) )
<span class="comment">// native query</span>
Restaurant.findAllByLocationNear( [<span class="error">$</span><span class="key">geometry</span>: [<span class="key">type</span>:<span class="string"><span class="delimiter">'</span><span class="content">Point</span><span class="delimiter">'</span></span>, <span class="key">coordinates</span>: [<span class="integer">1</span>,<span class="integer">7</span>]], <span class="error">$</span><span class="key">maxDistance</span>:<span class="integer">30000</span>] )
<span class="comment">// criteria query</span>
Restaurant.withCriteria {
    near <span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>, <span class="predefined-type">Point</span>.valueOf(<span class="integer">1</span>,<span class="integer">7</span>), <span class="integer">300000</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_9">Description</h5>
<div class="paragraph">
<p>Specifies a point for which a geospatial query returns the closest documents first. The query sorts the documents from nearest to farthest. See <a href="https://docs.mongodb.org/manual/reference/operator/query/near/">$near</a> documentation for more info.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-findByNearSphere">findByNearSphere</h4>
<div class="sect4">
<h5 id="_purpose_10">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <a href="https://docs.mongodb.org/manual/reference/operator/query/nearSphere/">$nearSphere</a> query</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_10">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.mongodb.geo.*</span>
...
Restaurant.findByLocationNearSphere( <span class="predefined-type">Point</span>.valueOf( <span class="integer">40</span>, <span class="integer">40</span> ) )
<span class="comment">// native query</span>
Restaurant.findAllByLocationNearSphere( [<span class="error">$</span><span class="key">geometry</span>: [<span class="key">type</span>:<span class="string"><span class="delimiter">'</span><span class="content">Point</span><span class="delimiter">'</span></span>, <span class="key">coordinates</span>: [<span class="integer">1</span>,<span class="integer">7</span>]], <span class="error">$</span><span class="key">maxDistance</span>:<span class="integer">30000</span>] )
<span class="comment">// criteria query</span>
Restaurant.withCriteria {
    nearSphere <span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>, <span class="predefined-type">Point</span>.valueOf(<span class="integer">1</span>,<span class="integer">7</span>), <span class="integer">300000</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_10">Description</h5>
<div class="paragraph">
<p>Specifies a point for which a geospatial query returns the closest documents first. The query sorts the documents from nearest to farthest. MongoDB calculates distances for $nearSphere using spherical geometry.</p>
</div>
<div class="paragraph">
<p>See the documentation for the <a href="https://docs.mongodb.org/manual/reference/operator/query/nearSphere/">$nearSphere</a> query operator.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-findByWithinBox">findByWithinBox</h4>
<div class="sect4">
<h5 id="_purpose_11">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <code>$within</code> query on legacy coordinate pairs</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The $within operator is considered legacy and replaced by $geoWithin. Hence this method is deprecated and <code>findByGeoWithin</code> should be used instead
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_examples_11">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Hotel.findByLocationWithinBox( [[<span class="integer">40</span>, <span class="integer">30</span>],[<span class="integer">60</span>, <span class="integer">70</span>]] )
Hotel.findByLocationWithinBox( <span class="predefined-type">Box</span>.valueOf([[<span class="integer">40</span>, <span class="integer">30</span>],[<span class="integer">60</span>, <span class="integer">70</span>]]) )</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-findByWithinCircle">findByWithinCircle</h4>
<div class="sect4">
<h5 id="_purpose_12">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <code>$within</code> query on legacy coordinate pairs</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The $within operator is considered legacy and replaced by $geoWithin. Hence this method is deprecated and <code>findByGeoWithin</code> should be used instead
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_examples_12">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Hotel.findByLocationWithinCircle([[<span class="integer">40</span>, <span class="integer">30</span>],<span class="integer">40</span>])
Hotel.findByLocationWithinCircle( Circle.valueOf( [[<span class="integer">40</span>, <span class="integer">30</span>],<span class="integer">40</span>] ) )</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-search">search</h4>
<div class="sect4">
<h5 id="_purpose_13">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <a href="https://docs.mongodb.com/manual/reference/operator/query/text/#op._S_text">$text</a> search query</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_13">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Product.search(<span class="string"><span class="delimiter">&quot;</span><span class="content">coffee</span><span class="delimiter">&quot;</span></span>).size() == <span class="integer">5</span>
<span class="keyword">assert</span> Product.search(<span class="string"><span class="delimiter">&quot;</span><span class="content">bake coffee cake</span><span class="delimiter">&quot;</span></span>).size() == <span class="integer">10</span>
<span class="keyword">assert</span> Product.search(<span class="string"><span class="delimiter">&quot;</span><span class="content">bake coffee -cake</span><span class="delimiter">&quot;</span></span>).size() == <span class="integer">6</span>
<span class="keyword">assert</span> Product.search(<span class="string"><span class="delimiter">'</span><span class="content">&quot;Coffee Cake&quot;</span><span class="delimiter">'</span></span>).size() == <span class="integer">1</span>

<span class="keyword">assert</span> Product.search(<span class="string"><span class="delimiter">'</span><span class="content">tarta</span><span class="delimiter">'</span></span>, [<span class="key">language</span>:<span class="string"><span class="delimiter">'</span><span class="content">es</span><span class="delimiter">'</span></span>, <span class="key">offset</span>:<span class="integer">5</span>, <span class="key">max</span>:<span class="integer">10</span>])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_11">Description</h5>
<div class="paragraph">
<p>The <code>search</code> method uses MongoDB&#8217;s full text search support to perform full text search on a "text" index.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-searchTop">searchTop</h4>
<div class="sect4">
<h5 id="_purpose_14">Purpose</h5>
<div class="paragraph">
<p>Executes a MongoDB <a href="https://docs.mongodb.com/manual/reference/operator/query/text/#op._S_text">$text</a> search query</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_14">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Product.searchTop(<span class="string"><span class="delimiter">&quot;</span><span class="content">coffee</span><span class="delimiter">&quot;</span></span>).size() == <span class="integer">5</span>
<span class="keyword">assert</span> Product.searchTop(<span class="string"><span class="delimiter">&quot;</span><span class="content">coffee</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_12">Description</h5>
<div class="paragraph">
<p>The <code>searchTop</code> method uses MongoDB&#8217;s full text search support to perform full text search on a "text" index with the results sorted by the MongoDB score. The method by default returns the top 5 results, but the second argument can be used to customize the number of results (top 3, top 10 etc.)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-useCollection">useCollection</h4>
<div class="sect4">
<h5 id="_purpose_15">Purpose</h5>
<div class="paragraph">
<p>Allows switching which collection to use to persist for the domain class for the scope of the current session (connection).</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_15">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.useCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">non-fiction</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_13">Description</h5>
<div class="paragraph">
<p>The <code>useCollection</code> method allows switching, at runtime, the collection used persist and retrieve domain classes. The <code>collectionName</code> property will return the current collection being used. Note that the method switches the collection used for the scope of the current session/connection (ie. it is not permanent). If you wish to permanently change the collection used then you need to configure the mapping of the domain class.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-useDatabase">useDatabase</h4>
<div class="sect4">
<h5 id="_purpose_16">Purpose</h5>
<div class="paragraph">
<p>Allows switching which database to use to persist for the domain class for the scope of the current session (connection).</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_16">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Book</span>.useDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">non-fiction</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_14">Description</h5>
<div class="paragraph">
<p>The <code>useDatabase</code> method allows switching, at runtime, the database used persist and retrieve domain classes. The <code>DB</code> property will return the current database being used. Note that the method switches the database used for the scope of the current session/connection (ie. it is not permanent). If you wish to permanently change the database used then you need to configure the mapping of the domain class.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-withCollection">withCollection</h4>
<div class="sect4">
<h5 id="_purpose_17">Purpose</h5>
<div class="paragraph">
<p>Allows switching which collection to use to persist for the domain class for the scope of the given closure</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_17">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.withCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">non-fiction</span><span class="delimiter">&quot;</span></span>) {
    <span class="comment">// code here</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_15">Description</h5>
<div class="paragraph">
<p>The <code>useCollection</code> method allows switching, at runtime, the collection used persist and retrieve domain classes. The <code>collectionName</code> property will return the current collection being used. Note that the method switches the collection used for the scope of given closure (ie. it is not permanent). If you wish to permanently change the collection used then you need to configure the mapping of the domain class.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-domain-classes-withDatabase">withDatabase</h4>
<div class="sect4">
<h5 id="_purpose_18">Purpose</h5>
<div class="paragraph">
<p>Allows switching which database to use to persist for the domain class for the scope of the given closure.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_18">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Book</span>.withDatabase(<span class="string"><span class="delimiter">&quot;</span><span class="content">non-fiction</span><span class="delimiter">&quot;</span></span>) {
    <span class="comment">// code here</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_16">Description</h5>
<div class="paragraph">
<p>The <code>withDatabase</code> method allows switching, at runtime, the database used persist and retrieve domain classes. The <code>DB</code> property will return the current database being used. Note that the method switches the database used for the scope of the given closure (ie. it is not permanent). If you wish to permanently change the database used then you need to configure the mapping of the domain class.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 8.0.0-SNAPSHOT<br>
</div>
</div>
</body>
</html>